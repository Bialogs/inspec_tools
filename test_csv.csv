title,desc,impact,refs,severity,gtitle,gid,rid,stig_id,nist,check,fix,code,source_location,id,status,code_desc,run_time,start_time,skip_message,resource
"The Web site software used with the web server must have all
  applicable security patches applied and documented.","The IAVM process does not address all patches that have been identified
  for the host operating system or, in this case, the web server software
  environment. Many vendors have subscription services available to notify
  users of known security threats. The site needs to be aware of these fixes
  and make determinations based on local policy and what software features are
  installed, if these patches need to be applied.

  In some cases, patches also apply to middleware and database systems.
  Maintaining the security of web servers requires frequent reviews of security
  notices. Many security notices mandate the installation of a software patch to
  overcome security vulnerabilities.

  SAs and ISSOs should regularly check the vendor support web site for patches
  and information related to the web server software. All applicable security
  patches will be applied to the operating system and to the web server
  software. Security patches are deemed applicable if the product is installed,
  even if it is not used or is disabled.",0.5,[],medium,WA230,V-13613,SV-32969r2_rule,WA230 A22,"[""CM-6"", ""Rev_4""]","Query the web administrator to determine if the site has a
  detailed process as part of its configuration management plan to stay
  compliant with all security-related patches.

  Proposed Questions: How does the SA stay current with web server vendor
  patches? How is the SA notified when a new security patch is issued by the
  vendor? (Exclude the IAVM.) What is the process followed for applying patches
  to the web server?

  If the site is not in compliance with all applicable security patches, this is
  a finding.","Establish a detailed process as part of the configuration
  management plan to stay compliant with all web server security-related
  patches.","control ""V-13613"" do

  title ""The Web site software used with the web server must have all
  applicable security patches applied and documented.""

  desc ""The IAVM process does not address all patches that have been identified
  for the host operating system or, in this case, the web server software
  environment. Many vendors have subscription services available to notify
  users of known security threats. The site needs to be aware of these fixes
  and make determinations based on local policy and what software features are
  installed, if these patches need to be applied.

  In some cases, patches also apply to middleware and database systems.
  Maintaining the security of web servers requires frequent reviews of security
  notices. Many security notices mandate the installation of a software patch to
  overcome security vulnerabilities.

  SAs and ISSOs should regularly check the vendor support web site for patches
  and information related to the web server software. All applicable security
  patches will be applied to the operating system and to the web server
  software. Security patches are deemed applicable if the product is installed,
  even if it is not used or is disabled.  ""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WA230""
  tag ""gid"": ""V-13613""
  tag ""rid"": ""SV-32969r2_rule""
  tag ""stig_id"": ""WA230 A22""
  tag ""nist"": [""CM-6"", ""Rev_4""]

  tag ""check"": ""Query the web administrator to determine if the site has a
  detailed process as part of its configuration management plan to stay
  compliant with all security-related patches.

  Proposed Questions: How does the SA stay current with web server vendor
  patches? How is the SA notified when a new security patch is issued by the
  vendor? (Exclude the IAVM.) What is the process followed for applying patches
  to the web server?

  If the site is not in compliance with all applicable security patches, this is
  a finding.""

  tag ""fix"": ""Establish a detailed process as part of the configuration
  management plan to stay compliant with all web server security-related
  patches.""

  begin
    describe linux_update do
      it { should be_uptodate }
    end

    linux_update.updates.each do |update|
      describe package(update['name']) do
        its('version') { should eq update['version'] }
      end
    end
  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-13613.rb"", ""line""=>29}",V-13613,passed,Linux Update should be uptodate,0.62424,2017-09-22 14:12:44 -0400,"",""
"A private web server’s list of CAs in a trust hierarchy must lead to
  an authorizedDoD PKI Root CA.","A PKI certificate is a digital identifier that establishes the identity
  of an individual or a platform. A server that has a certificate provides
  users with third-party confirmation of authenticity. Most web browsers
  perform server authentication automatically and the user is notified only if
  the authentication fails. The authentication process between the server and
  the client is performed using the SSL/TLS protocol. Digital certificates are
  authenticated, issued, and managed by a trusted Certificate Authority (CA).

  The use of a trusted certificate validation hierarchy is crucial to the
  ability to control access to a site’s server and to prevent unauthorized
  access. Only DoD-approved PKIs will be utilized.",0.5,[],medium,WG355,V-13620,SV-32936r1_rule,WG355 A22,"[""IA-5"", ""SC-12"", ""Rev_4""]","Enter the following command:

  find / -name ssl.conf  note the path of the file.

  grep ssl_client_certificate in conf files in context http,server

  Review the results to determine the path of the ssl_client_certificate.

  more /path/of/ca-bundle.crt

  Examine the contents of this file to determine if the trusted CAs are DoD
  approved. If the trusted CA that is used to authenticate users to the web site
  does not lead to an approved DoD CA, this is a finding.

  NOTE: There are non DoD roots that must be on the server in order for it to
  function. Some applications, such as anti-virus programs, require root CAs to
  function. DoD approved certificate can include the External Certificate
  Authorities (ECA), if approved by the DAA. The PKE InstallRoot 3.06 System
  Administrator Guide (SAG), dated 8 Jul 2008, contains a complete list of DoD,
  ECA, and IECA CAs.","Configure the web server’s trust store to trust only DoD-
  approved PKIs (e.g., DoD PKI, DoD ECA, and DoD-approved external partners).","control ""V-13620"" do

  title ""A private web server’s list of CAs in a trust hierarchy must lead to
  an authorizedDoD PKI Root CA.""

  desc ""A PKI certificate is a digital identifier that establishes the identity
  of an individual or a platform. A server that has a certificate provides
  users with third-party confirmation of authenticity. Most web browsers
  perform server authentication automatically and the user is notified only if
  the authentication fails. The authentication process between the server and
  the client is performed using the SSL/TLS protocol. Digital certificates are
  authenticated, issued, and managed by a trusted Certificate Authority (CA).

  The use of a trusted certificate validation hierarchy is crucial to the
  ability to control access to a site’s server and to prevent unauthorized
  access. Only DoD-approved PKIs will be utilized. ""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WG355""
  tag ""gid"": ""V-13620""
  tag ""rid"": ""SV-32936r1_rule""
  tag ""stig_id"": ""WG355 A22""
  tag ""nist"": [""IA-5"", ""SC-12"", ""Rev_4""]

  tag ""check"": ""Enter the following command:

  find / -name ssl.conf  note the path of the file.

  grep """"ssl_client_certificate"""" in conf files in context http,server

  Review the results to determine the path of the ssl_client_certificate.

  more /path/of/ca-bundle.crt

  Examine the contents of this file to determine if the trusted CAs are DoD
  approved. If the trusted CA that is used to authenticate users to the web site
  does not lead to an approved DoD CA, this is a finding.

  NOTE: There are non DoD roots that must be on the server in order for it to
  function. Some applications, such as anti-virus programs, require root CAs to
  function. DoD approved certificate can include the External Certificate
  Authorities (ECA), if approved by the DAA. The PKE InstallRoot 3.06 System
  Administrator Guide (SAG), dated 8 Jul 2008, contains a complete list of DoD,
  ECA, and IECA CAs.""

  tag ""fix"": ""Configure the web server’s trust store to trust only DoD-
  approved PKIs (e.g., DoD PKI, DoD ECA, and DoD-approved external partners).""

  begin
    nginx_conf_handle = nginx_conf(NGINX_CONF_FILE)

    nginx_conf_handle.http.entries.each do |http|
      describe http.params['ssl_client_certificate'] do
        it { should_not be_nil}
      end
      http.params['ssl_client_certificate'].each do |cert|
        describe x509_certificate(cert.join) do
          it { should_not be_nil}
          its('subject.C') { should cmp 'US'}
          its('subject.O') { should cmp 'U.S. Government'}
        end
        describe x509_certificate(cert.join).subject.CN[0..2] do
          it { should be_in DOD_APPROVED_PKIS}
        end
      end unless http.params['ssl_client_certificate'].nil?
    end

    nginx_conf_handle.servers.entries.each do |server|
      server.params['ssl_client_certificate'].each do |cert|
        describe x509_certificate(cert.join) do
          it { should_not be_nil}
          its('subject.C') { should cmp 'US'}
          its('subject.O') { should cmp 'U.S. Government'}
        end
        describe x509_certificate(cert.join).subject.CN[0..2] do
          it { should be_in DOD_APPROVED_PKIS}
        end
      end unless server.params['ssl_client_certificate'].nil?
    end

  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-13620.rb"", ""line""=>42}",V-13620,"passed,passed,passed,passed,passed","[[""/etc/ssl/certs/dod-root-certs.pem""]] should not be nil,x509_certificate /etc/ssl/certs/dod-root-certs.pem should not be nil,x509_certificate /etc/ssl/certs/dod-root-certs.pem subject.C should cmp == ""US"",x509_certificate /etc/ssl/certs/dod-root-certs.pem subject.O should cmp == ""U.S. Government"",DoD should be in ""DoD"" and ""ECA""","0.000165,0.000148,0.000452,0.00032,0.000231","2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400",",,,,",",,,,"
"All web server documentation, sample code, example applications, and
  tutorials must be removed from a production web server.","Web server documentation, sample code, example applications, and
  tutorials may be an exploitable threat to a web server. A production web
  server may only contain components that are operationally necessary (e.g.,
  compiled code, scripts, web-content, etc.). Delete all directories that
  contain samples and any scripts used to execute the samples. If there is a
  requirement to maintain these directories at the site on non-production
  servers for training purposes, have permissions set to only allow access to
  authorized users (i.e., web administrators and systems administrators).
  Sample applications or scripts have not been evaluated and approved for use
  and may introduce vulnerabilities to the system.",0.7,[],high,WG385,V-13621,SV-32933r1_rule,WG385 A22,"[""CM-6"", ""Rev_4""]","Query the SA to determine if all directories that contain
  samples and any scripts used to execute the samples have been removed from
  the server. Each web server has its own list of sample files. This may
  change with the software versions, but the following are some examples of
  what to look for (This should not be the definitive list of sample files,
  but only an example of the common samples that are provided with the
  associated web server. This list will be updated as additional information
  is discovered.):

  ls -Ll /usr/share/man/man8/nginx.8.gz

  If there is a requirement to maintain these directories at the site for
  training or other such purposes, have permissions or set the permissions to
  only allow access to authorized users. If any sample files are found on the
  web server, this is a finding.","","control ""V-13621"" do

  title ""All web server documentation, sample code, example applications, and
  tutorials must be removed from a production web server.""

  desc ""Web server documentation, sample code, example applications, and
  tutorials may be an exploitable threat to a web server. A production web
  server may only contain components that are operationally necessary (e.g.,
  compiled code, scripts, web-content, etc.). Delete all directories that
  contain samples and any scripts used to execute the samples. If there is a
  requirement to maintain these directories at the site on non-production
  servers for training purposes, have permissions set to only allow access to
  authorized users (i.e., web administrators and systems administrators).
  Sample applications or scripts have not been evaluated and approved for use
  and may introduce vulnerabilities to the system.""

  impact 0.7
  tag ""severity"": ""high""
  tag ""gtitle"": ""WG385""
  tag ""gid"": ""V-13621""
  tag ""rid"": ""SV-32933r1_rule""
  tag ""stig_id"": ""WG385 A22""
  tag ""nist"": [""CM-6"", ""Rev_4""]

  tag ""check"": ""Query the SA to determine if all directories that contain
  samples and any scripts used to execute the samples have been removed from
  the server. Each web server has its own list of sample files. This may
  change with the software versions, but the following are some examples of
  what to look for (This should not be the definitive list of sample files,
  but only an example of the common samples that are provided with the
  associated web server. This list will be updated as additional information
  is discovered.):

  ls -Ll /usr/share/man/man8/nginx.8.gz

  If there is a requirement to maintain these directories at the site for
  training or other such purposes, have permissions or set the permissions to
  only allow access to authorized users. If any sample files are found on the
  web server, this is a finding.""

  begin
    NGINX_DISALLOWED_FILE_LIST.each do |file|
      describe file(file) do
        it { should_not exist }
      end
    end

    NGINX_EXCEPTION_FILES.each do |file|
      describe file(file) do
        it { should exist }
        it { should be_owned_by NGINX_OWNER }
        it { should be_grouped_into NGINX_GROUP }
        its('mode') { should cmp '640' }
      end
    end
  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-13621.rb"", ""line""=>57}",V-13621,passed,File /usr/share/man/man8/nginx.8.gz should not exist,0.090759,2017-09-22 14:12:45 -0400,"",""
"The private web server must use an approved DoD certificate
  validation process.","Without the use of a certificate validation process, the site is
  vulnerable to accepting certificates that have expired or have been revoked.
  This would allow unauthorized individuals access to the web server.  This also
  defeats the purpose of the multi-factor authentication provided by the PKI
  process.",0.5,[],medium,WG145,V-13672,SV-32954r2_rule,WG145 A22,"[""IA-5"", ""SC-12"", ""Rev_4""]","The reviewer should query the ISSO, the SA, the web
  administrator, or developers as necessary to determine if the web server is
  configured to utilize an approved DoD certificate validation process.

  The web administrator should be questioned to determine if a validation
  process is being utilized on the web server.

  To validate this, the reviewer can ask the web administrator to describe the
  validation process being used. They should be able to identify either the use
  of certificate revocation lists (CRLs) or Online Certificate Status Protocol
  (OCSP).

  If the production web server is accessible, the SA or the web administrator
  should be able to demonstrate the validation of good certificates and the
  rejection of bad certificates.

  If CRLs are being used, the SA should be able to identify how often the CRL is
  updated and the location from which the CRL is downloaded.

  If the web administrator cannot identify the type of validation process being
  used, this is a finding.","Configure DoD Private Web Servers to conduct certificate
  revocation checking utilizing certificate revocation lists (CRLs) or Online
  Certificate Status Protocol (OCSP).","control ""V-13672"" do

  title ""The private web server must use an approved DoD certificate
  validation process.""

  desc  ""Without the use of a certificate validation process, the site is
  vulnerable to accepting certificates that have expired or have been revoked.
  This would allow unauthorized individuals access to the web server.  This also
  defeats the purpose of the multi-factor authentication provided by the PKI
  process. ""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WG145""
  tag ""gid"": ""V-13672""
  tag ""rid"": ""SV-32954r2_rule""
  tag ""stig_id"": ""WG145 A22""
  tag ""nist"": [""IA-5"", ""SC-12"", ""Rev_4""]

  tag ""check"": ""The reviewer should query the ISSO, the SA, the web
  administrator, or developers as necessary to determine if the web server is
  configured to utilize an approved DoD certificate validation process.

  The web administrator should be questioned to determine if a validation
  process is being utilized on the web server.

  To validate this, the reviewer can ask the web administrator to describe the
  validation process being used. They should be able to identify either the use
  of certificate revocation lists (CRLs) or Online Certificate Status Protocol
  (OCSP).

  If the production web server is accessible, the SA or the web administrator
  should be able to demonstrate the validation of good certificates and the
  rejection of bad certificates.

  If CRLs are being used, the SA should be able to identify how often the CRL is
  updated and the location from which the CRL is downloaded.

  If the web administrator cannot identify the type of validation process being
  used, this is a finding.""

  tag ""fix"": ""Configure DoD Private Web Servers to conduct certificate
  revocation checking utilizing certificate revocation lists (CRLs) or Online
  Certificate Status Protocol (OCSP).""

  begin
    require 'time'

    #@todo complete ocsp verification test
    # oscp_status = command(""openssl s_client -connect #{OCSP_SERVER} -tls1  -tlsextdebug  -status 2>&1 < /dev/null"").stdout
    #
    # describe oscp_status do
    #   it { should match %r(OCSP Response Status: successful)}
    # end

    def days_since_crl_update(cert)
      ((Time.new - Time.at(file(cert).mtime.to_f)) / 86400)
    end

    nginx_conf_handle = nginx_conf(NGINX_CONF_FILE)

    nginx_conf_handle.http.entries.each do |http|
      describe http.params['ssl_crl'] do
        it { should_not be_nil}
      end
      http.params['ssl_crl'].each do |cert|
        describe file(cert.join) do
          it { should be_file }
        end
        describe days_since_crl_update(cert.join) do
          it { should cmp < CRL_UDPATE_FREQUENCY }
        end
      end unless http.params['ssl_crl'].nil?
    end

    nginx_conf_handle.servers.entries.each do |server|
      server.params['ssl_crl'].each do |cert|
        describe file(cert.join) do
          it { should be_file }
        end
        describe days_since_crl_update(cert.join) do
          it { should cmp < CRL_UDPATE_FREQUENCY }
        end
      end unless server.params['ssl_crl'].nil?
    end

  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-13672.rb"", ""line""=>43}",V-13672,"passed,passed,passed","[[""/etc/ssl/certs/DOD.crl""]] should not be nil,File /etc/ssl/certs/DOD.crl should be file,0.28995194145833336 should cmp < 7","0.000139,0.000135,0.000189","2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400",",,",",,"
The client body and header timeout directives must be properly set.,"The timeout requirements are set to mitigate the effects of several
  types of denial of service attacks. Although there is some latitude
  concerning the settings themselves, the requirements attempt to provide
  reasonable limits for the protection of the web server. If necessary, these
  limits can be adjusted to accommodate the operational requirement of a given
  system.

  client_body_timeout defines a timeout for reading client request body. The
  timeout is set only for a period between two successive read operations, not
  for the transmission of the whole request body. If a client does not transmit
  anything within this time, the 408 (Request Time-out) error is returned to the
  client.

  client_header_timeout defines a timeout for reading client request header. If
  a client does not transmit the entire header within this time, the 408
  (Request Time-out) error is returned to the client.",0.5,[],medium,WA000-WWA020,V-13724,SV-32977r1_rule,WA000-WWA020 A22,"[""CM-6"", ""Rev_4""]","To view the timeout values enter the following commands:

  grep client_body_timeout on the nginx.conf file and any separate included
  configuration files

  grep client_header_timeout on the nginx.conf file and any separate
  included configuration files

  If the values of each are not set to 10 seconds (10s) or less, this is a
  finding.","Edit the configuration file and set the value of 10 seconds or
  less:

  client_body_timeout   10s;

  client_header_timeout 10s;","control ""V-13724"" do
  title ""The client body and header timeout directives must be properly set.""

  desc ""The timeout requirements are set to mitigate the effects of several
  types of denial of service attacks. Although there is some latitude
  concerning the settings themselves, the requirements attempt to provide
  reasonable limits for the protection of the web server. If necessary, these
  limits can be adjusted to accommodate the operational requirement of a given
  system.

  client_body_timeout defines a timeout for reading client request body. The
  timeout is set only for a period between two successive read operations, not
  for the transmission of the whole request body. If a client does not transmit
  anything within this time, the 408 (Request Time-out) error is returned to the
  client.

  client_header_timeout defines a timeout for reading client request header. If
  a client does not transmit the entire header within this time, the 408
  (Request Time-out) error is returned to the client. ""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WA000-WWA020""
  tag ""gid"": ""V-13724""
  tag ""rid"": ""SV-32977r1_rule""
  tag ""stig_id"": ""WA000-WWA020 A22""
  tag ""nist"": [""CM-6"", ""Rev_4""]

  tag ""check"": ""To view the timeout values enter the following commands:

  grep """"client_body_timeout"""" on the nginx.conf file and any separate included
  configuration files

  grep """"client_header_timeout"""" on the nginx.conf file and any separate
  included configuration files

  If the values of each are not set to 10 seconds (10s) or less, this is a
  finding.""


  tag ""fix"": ""Edit the configuration file and set the value of 10 seconds or
  less:

  client_body_timeout   10s;

  client_header_timeout 10s;""

  begin
    nginx_conf_handle = nginx_conf(NGINX_CONF_FILE)

    nginx_conf_handle.http.entries.each do |http|
      describe http.params['client_header_timeout'] do
        it { should_not be_nil}
      end
      describe http.params['client_header_timeout'].flatten do
        it { should cmp <= 10 }
      end unless http.params['client_header_timeout'].nil?

      describe http.params['client_body_timeout'] do
        it { should_not be_nil}
      end
      describe http.params['client_body_timeout'].flatten do
        it { should cmp <= 10 }
      end unless http.params['client_body_timeout'].nil?
    end

    nginx_conf_handle.servers.entries.each do |server|
      describe server.params['client_header_timeout'].flatten do
        it { should cmp <= 10 }
      end unless server.params['client_header_timeout'].nil?
      describe server.params['client_body_timeout'].flatten do
        it { should cmp <= 10 }
      end unless server.params['client_body_timeout'].nil?
    end


  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-13724.rb"", ""line""=>36}",V-13724,"passed,passed,passed,passed","[[""10""]] should not be nil,[""10""] should cmp <= 10,[[""10""]] should not be nil,[""10""] should cmp <= 10","8.3e-05,0.000261,0.000141,0.00017","2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400",",,,",",,,"
The KeepAliveTimeout directive must be defined.,"The number of seconds Apache will wait for a subsequent request before
  closing the connection. Once a request has been received, the timeout value
  specified by the Timeout directive applies. Setting KeepAliveTimeout to a
  high value may cause performance problems in heavily loaded servers. The
  higher the timeout, the more server processes will be kept occupied waiting
  on connections with idle clients. These requirements are set to mitigate the
  effects of several types of denial of service attacks.",0.5,[],medium,WA000-WWA024,V-13726,SV-32877r1_rule,WA000-WWA024 A22,"[""CM-6"", ""Rev_4""]","To view the keepalive_timeout directive value enter the
  following command:

  grep keepalive_timeout on the nginx.conf file and any separate included
  configuration files

  If the value of keepalive_timeout is not set to 5 (seconds) or less, this
  is a finding:

  keepalive_timeout   5 5;

  The first parameter sets a timeout during which a keep-alive client connection
  will stay open on the server side. The zero value disables keep-alive client
  connections. The second parameter sets a value in the “Keep-Alive:
  timeout=time” response header field. The “Keep-Alive: timeout=time” header
  field is recognized by Mozilla and Konqueror. ","Edit the configuration file and set the value of
  keepalive_timeout to the value of 5 or less:

  keepalive_timeout   5 5;","control ""V-13726"" do
  title ""The KeepAliveTimeout directive must be defined.""

  desc ""The number of seconds Apache will wait for a subsequent request before
  closing the connection. Once a request has been received, the timeout value
  specified by the Timeout directive applies. Setting KeepAliveTimeout to a
  high value may cause performance problems in heavily loaded servers. The
  higher the timeout, the more server processes will be kept occupied waiting
  on connections with idle clients. These requirements are set to mitigate the
  effects of several types of denial of service attacks. ""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WA000-WWA024""
  tag ""gid"": ""V-13726""
  tag ""rid"": ""SV-32877r1_rule""
  tag ""stig_id"": ""WA000-WWA024 A22""
  tag ""nist"": [""CM-6"", ""Rev_4""]

  tag ""check"": ""To view the keepalive_timeout directive value enter the
  following command:

  grep """"keepalive_timeout"""" on the nginx.conf file and any separate included
  configuration files

  If the value of """"keepalive_timeout"""" is not set to 5 (seconds) or less, this
  is a finding:

  keepalive_timeout   5 5;

  The first parameter sets a timeout during which a keep-alive client connection
  will stay open on the server side. The zero value disables keep-alive client
  connections. The second parameter sets a value in the “Keep-Alive:
  timeout=time” response header field. The “Keep-Alive: timeout=time” header
  field is recognized by Mozilla and Konqueror. ""

  tag ""fix"": ""Edit the configuration file and set the value of
  """"keepalive_timeout"""" to the value of 5 or less:

  keepalive_timeout   5 5;""

  begin
    nginx_conf_handle = nginx_conf(NGINX_CONF_FILE)

    nginx_conf_handle.http.entries.each do |http|
      describe http.params['keepalive_timeout'] do
        it { should cmp [['5', '5']] }
      end
    end

    nginx_conf_handle.servers.entries.each do |server|
      describe server.params['keepalive_timeout'] do
        it { should cmp [['5', '5']] }
      end unless server.params['keepalive_timeout'].nil?
    end

    nginx_conf_handle.locations.entries.each do |location|
      describe location.params['keepalive_timeout'] do
        it { should cmp [['5', '5']] }
      end unless location.params['keepalive_timeout'].nil?
    end

  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-13726.rb"", ""line""=>35}",V-13726,passed,"[[""5"", ""5""]] should cmp == [[""5"", ""5""]]",0.000153,2017-09-22 14:12:45 -0400,"",""
The worker_processes StartServers directive must be set properly.,"These requirements are set to mitigate the effects of several types of
  denial of service attacks. Although there is some latitude concerning the
  settings themselves, the requirements attempt to provide reasonable limits
  for the protection of the web server. If necessary, these limits can be
  adjusted to accommodate the operational requirement of a given system.",0.5,[],medium,WA000-WWA026,V-13727,SV-36645r2_rule,WA000-WWA026 A22,"[""CM-6"", ""Rev_4""]","To view the worker_processes directive value enter the
  following command:

  grep worker_processes on the nginx.conf file and any separate included
  configuration files

  If the value of worker_processes is not set to auto or explicitly set,
  this is a finding:

  worker_processes   auto;

  worker_processes defines the number of worker processes. The optimal value
  depends on many factors including (but not limited to) the number of CPU
  cores, the number of hard disk drives that store data, and load pattern. When
  one is in doubt, setting it to the number of available CPU cores would be a
  good start (the value “auto” will try to autodetect it).","Edit the configuration file and set the value of
  worker_processes to the value of auto or a value of 1 or higher:

  worker_processes auto;","control ""V-13727"" do
  title ""The worker_processes StartServers directive must be set properly.""

  desc ""These requirements are set to mitigate the effects of several types of
  denial of service attacks. Although there is some latitude concerning the
  settings themselves, the requirements attempt to provide reasonable limits
  for the protection of the web server. If necessary, these limits can be
  adjusted to accommodate the operational requirement of a given system.""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WA000-WWA026""
  tag ""gid"": ""V-13727""
  tag ""rid"": ""SV-36645r2_rule""
  tag ""stig_id"": ""WA000-WWA026 A22""
  tag ""nist"": [""CM-6"", ""Rev_4""]

  tag ""check"": ""To view the worker_processes directive value enter the
  following command:

  grep """"worker_processes"""" on the nginx.conf file and any separate included
  configuration files

  If the value of """"worker_processes"""" is not set to auto or explicitly set,
  this is a finding:

  worker_processes   auto;

  worker_processes defines the number of worker processes. The optimal value
  depends on many factors including (but not limited to) the number of CPU
  cores, the number of hard disk drives that store data, and load pattern. When
  one is in doubt, setting it to the number of available CPU cores would be a
  good start (the value “auto” will try to autodetect it).""

  tag ""fix"": ""Edit the configuration file and set the value of
  """"worker_processes"""" to the value of auto or a value of 1 or higher:

  worker_processes auto;""

  begin
    describe nginx_conf(NGINX_CONF_FILE).params['worker_processes'] do
      it { should cmp [['auto']] }
    end
  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end

end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-13727.rb"", ""line""=>36}",V-13727,passed,"[[""auto""]] should cmp == [[""auto""]]",0.000151,2017-09-22 14:12:45 -0400,"",""
The disable_symlinks setting must be on.,"The disable_symlinks directive determines how symbolic links should be
  treated when opening files.A symbolic link allows a file or a directory to
  be referenced using a symbolic name raising a potential hazard if symbolic
  linkage is made to a sensitive area. When web scripts are executed and
  symbolic links are allowed, the web user could be allowed to access
  locations on the web server that are outside the scope of the web document
  root or home directory.",0.5,[],medium,WA000-WWA052,V-13732,SV-40129r1_rule,WA000-WWA052 A22,"[""CM-6"", ""Rev_4""]","To view the disable_symlinks directive value enter the
  following command:

  grep disable_symlinks on the nginx.conf file and any separate included
  configuration files

  If the value of disable_symlinks is not set to on, this is a finding:

  disable_symlinks   on;

  If any component of the pathname is a symbolic link, access to a file is
  denied.  ","Edit the configuration file and set the value of
  disable_symlinks to on:

  disable_symlinks   on;","control ""V-13732"" do
  title ""The """"disable_symlinks"""" setting must be on.""
  desc ""The disable_symlinks directive determines how symbolic links should be
  treated when opening files.A symbolic link allows a file or a directory to
  be referenced using a symbolic name raising a potential hazard if symbolic
  linkage is made to a sensitive area. When web scripts are executed and
  symbolic links are allowed, the web user could be allowed to access
  locations on the web server that are outside the scope of the web document
  root or home directory.""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WA000-WWA052""
  tag ""gid"": ""V-13732""
  tag ""rid"": ""SV-40129r1_rule""
  tag ""stig_id"": ""WA000-WWA052 A22""
  tag ""nist"": [""CM-6"", ""Rev_4""]

  tag ""check"": ""To view the disable_symlinks directive value enter the
  following command:

  grep """"disable_symlinks"""" on the nginx.conf file and any separate included
  configuration files

  If the value of """"disable_symlinks"""" is not set to on, this is a finding:

  disable_symlinks   on;

  If any component of the pathname is a symbolic link, access to a file is
  denied.  ""

  tag ""fix"": ""Edit the configuration file and set the value of
  """"disable_symlinks"""" to on:

  disable_symlinks   on;""

  begin
    nginx_conf_handle = nginx_conf(NGINX_CONF_FILE)

    nginx_conf_handle.http.entries.each do |http|
      describe http.params['disable_symlinks'] do
        it { should cmp [['on']] }
      end
    end

    nginx_conf_handle.servers.entries.each do |server|
      describe server.params['disable_symlinks'] do
        it { should cmp [['on']] }
      end unless server.params['disable_symlinks'].nil?
    end

    nginx_conf_handle.locations.entries.each do |location|
      describe location.params['disable_symlinks'] do
        it { should cmp [['on']] }
      end unless location.params['disable_symlinks'].nil?
    end

  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end

end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-13732.rb"", ""line""=>35}",V-13732,passed,"[[""on""]] should cmp == [[""on""]]",0.000246,2017-09-22 14:12:45 -0400,"",""
Directory indexing must be disabled on directories not containing index files.,"autoindex and random_index directives can be applied to further
  restrict access to file and directories.If a URL which maps to a directory
  is requested, and there is no DirectoryIndex (e.g., index.html) in that
  directory, then enabling these directives will return a formatted listing of
  the directory which is not acceptable.

  autoindex enables or disables the directory listing output. The
  ngx_http_random_index_module module processes requests ending with the slash
  character (‘/’) and picks a random file in a directory to serve as an index
  file. The module is processed before the ngx_http_index_module module.",0.5,[],medium,WA000-WWA058,V-13735,SV-32755r1_rule,WA000-WWA058 A22,"[""CM-6"", ""Rev_4""]","To view the autoindex and random_index values enter the
  following commands:

  grep autoindex on the nginx.conf file and any separate included
  configuration files

  grep random_index on the nginx.conf file and any separate included
  configuration files

  If the values of each are not set to off, this is a finding:

  autoindex off;

  random_index off;","Edit the configuration file and set the values to off:

  autoindex off;

  random_index off;","control ""V-13735"" do
  title ""Directory indexing must be disabled on directories not containing index files.""

  desc""autoindex and random_index directives can be applied to further
  restrict access to file and directories.If a URL which maps to a directory
  is requested, and there is no DirectoryIndex (e.g., index.html) in that
  directory, then enabling these directives will return a formatted listing of
  the directory which is not acceptable.

  autoindex enables or disables the directory listing output. The
  ngx_http_random_index_module module processes requests ending with the slash
  character (‘/’) and picks a random file in a directory to serve as an index
  file. The module is processed before the ngx_http_index_module module.""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WA000-WWA058""
  tag ""gid"": ""V-13735""
  tag ""rid"": ""SV-32755r1_rule""
  tag ""stig_id"": ""WA000-WWA058 A22""
  tag ""nist"": [""CM-6"", ""Rev_4""]

  tag ""check"": ""To view the autoindex and random_index values enter the
  following commands:

  grep """"autoindex"""" on the nginx.conf file and any separate included
  configuration files

  grep """"random_index"""" on the nginx.conf file and any separate included
  configuration files

  If the values of each are not set to off, this is a finding:

  autoindex off;

  random_index off;""

  tag ""fix"": ""Edit the configuration file and set the values to off:

  autoindex off;

  random_index off;""

  begin
    nginx_conf_handle = nginx_conf(NGINX_CONF_FILE)

    nginx_conf_handle.http.entries.each do |http|
      describe http.params['autoindex'] do
        it { should cmp [['off']] }
      end
    end

    nginx_conf_handle.servers.entries.each do |server|
      describe server.params['autoindex'] do
        it { should cmp [['off']] }
      end unless server.params['autoindex'].nil?
    end

    nginx_conf_handle.locations.entries.each do |location|
      describe location.params['autoindex'] do
        it { should cmp [['off']] }
      end unless location.params['autoindex'].nil?
      describe location.params['random_index'] do
        it { should cmp [['off']] }
      end
    end

  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end

end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-13735.rb"", ""line""=>35}",V-13735,"passed,passed","[[""off""]] should cmp == [[""off""]],[[""off""]] should cmp == [[""off""]]","0.00015,0.000148","2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400",",",","
The HTTP request message body size must be limited.,"Buffer overflow attacks are carried out by a malicious attacker sending
  amounts of data that the web server cannot store in a given size buffer. The
  eventual overflow of this buffer can overwrite system memory. Subsequently
  an attacker may be able to elevate privileges and take control of the
  server. The NGINX directive client_body_buffer_size and
  client_max_body_size limits the size of the client request body buffer
  and body content respectively, thereby limiting the chances for a buffer
  overflow.",0.5,[],medium,WA000-WWA060,V-13736,SV-32756r1_rule,WA000-WWA060 A22,"[""CM-6"", ""Rev_4""]","To view the client_body_buffer_size value enter the following
  command:

  grep client_body_buffer_size on the nginx.conf file and any separate
  included configuration files

  grep client_max_body_size on the nginx.conf file and any separate included
  configuration files

  If the values of each are not set to 100k or less, this is a finding. ","Edit the configuration file to set the client_body_buffer_size
  and client_max_body_size to 100k or less.","control ""V-13736"" do
  title ""The HTTP request message body size must be limited.""

  desc""Buffer overflow attacks are carried out by a malicious attacker sending
  amounts of data that the web server cannot store in a given size buffer. The
  eventual overflow of this buffer can overwrite system memory. Subsequently
  an attacker may be able to elevate privileges and take control of the
  server. The NGINX directive """"client_body_buffer_size"""" and
  """"client_max_body_size"""" limits the size of the client request body buffer
  and body content respectively, thereby limiting the chances for a buffer
  overflow. ""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WA000-WWA060""
  tag ""gid"": ""V-13736""
  tag ""rid"": ""SV-32756r1_rule""
  tag ""stig_id"": ""WA000-WWA060 A22""
  tag ""nist"": [""CM-6"", ""Rev_4""]

  tag ""check"": ""To view the client_body_buffer_size value enter the following
  command:

  grep """"client_body_buffer_size"""" on the nginx.conf file and any separate
  included configuration files

  grep """"client_max_body_size"""" on the nginx.conf file and any separate included
  configuration files

  If the values of each are not set to 100k or less, this is a finding. ""


  tag ""fix"": ""Edit the configuration file to set the client_body_buffer_size
  and client_max_body_size to 100k or less.""

  begin
    nginx_conf_handle = nginx_conf(NGINX_CONF_FILE)

    nginx_conf_handle.http.entries.each do |http|
      describe http.params['client_body_buffer_size'] do
        it { should_not be_nil}
      end
      describe http.params['client_body_buffer_size'].join.to_i do
        it { should cmp <= '100k'.to_i }
      end unless http.params['client_body_buffer_size'].nil?

      describe http.params['client_max_body_size'] do
        it { should_not be_nil}
      end
      describe http.params['client_max_body_size'].join.to_i do
        it { should cmp <= '100k'.to_i }
      end unless http.params['client_max_body_size'].nil?
    end

    nginx_conf_handle.servers.entries.each do |server|
      describe server.params['client_body_buffer_size'].join.to_i do
        it { should cmp <= '100k'.to_i }
      end unless server.params['client_body_buffer_size'].nil?

      describe server.params['client_max_body_size'].join.to_i do
        it { should cmp <= '100k'.to_i }
      end unless server.params['client_max_body_size'].nil?
    end

    nginx_conf_handle.locations.entries.each do |location|
      describe location.params['client_body_buffer_size'].join.to_i do
        it { should cmp <= '100k'.to_i }
      end unless location.params['client_body_buffer_size'].nil?

      describe location.params['client_max_body_size'].join.to_i do
        it { should cmp <= '100k'.to_i }
      end unless location.params['client_max_body_size'].nil?
    end

  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end

end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-13736.rb"", ""line""=>36}",V-13736,"passed,passed,passed,passed","[[""1k""]] should not be nil,1 should cmp <= 100,[[""1k""]] should not be nil,1 should cmp <= 100","8.4e-05,0.000185,0.000112,0.000189","2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400",",,,",",,,"
The HTTP request header fields must be limited. ,"Buffer overflow attacks are carried out by a malicious attacker sending
  amounts of data that the web server cannot store in a given size buffer. The
  eventual overflow of this buffer can overwrite system memory. Subsequently
  an attacker may be able to elevate privileges and take control of the
  server. The NGINX directive large_client_header_buffers limits the
  maximum number and size of buffers used for reading large client request
  header thereby limiting the chances for a buffer overflow.",0.5,[],medium,WA000-WWA062,V-13737,SV-32757r1_rule,WA000-WWA062 A22,"[""CM-6"", ""Rev_4""]","To view the large_client_header_buffers value enter the
  following command:

  grep large_client_header_buffers on the nginx.conf file and any separate
  included configuration files

  If the value of large_client_header_buffers is not set to 2 buffers at 1k,
  this is a finding. ","Edit the configuration file to set the
  large_client_header_buffers to 2 buffers and 1k.","control ""V-13737"" do
  title ""The HTTP request header fields must be limited. ""

  desc ""Buffer overflow attacks are carried out by a malicious attacker sending
  amounts of data that the web server cannot store in a given size buffer. The
  eventual overflow of this buffer can overwrite system memory. Subsequently
  an attacker may be able to elevate privileges and take control of the
  server. The NGINX directive """"large_client_header_buffers"""" limits the
  maximum number and size of buffers used for reading large client request
  header thereby limiting the chances for a buffer overflow. ""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WA000-WWA062""
  tag ""gid"": ""V-13737""
  tag ""rid"": ""SV-32757r1_rule""
  tag ""stig_id"": ""WA000-WWA062 A22""
  tag ""nist"": [""CM-6"", ""Rev_4""]

  tag ""check"": ""To view the large_client_header_buffers value enter the
  following command:

  grep """"large_client_header_buffers"""" on the nginx.conf file and any separate
  included configuration files

  If the value of large_client_header_buffers is not set to 2 buffers at 1k,
  this is a finding. ""

  tag ""fix"": ""Edit the configuration file to set the
  large_client_header_buffers to 2 buffers and 1k.""

  begin
    nginx_conf_handle = nginx_conf(NGINX_CONF_FILE)

    nginx_conf_handle.http.entries.each do |http|
      describe http.params['large_client_header_buffers'] do
        it { should cmp [['2','1k']] }
      end
    end

    nginx_conf_handle.servers.entries.each do |server|
      describe server.params['large_client_header_buffers'] do
        it { should cmp [['2','1k']] }
      end unless server.params['large_client_header_buffers'].nil?
    end

  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-13737.rb"", ""line""=>35}",V-13737,passed,"[[""2"", ""1k""]] should cmp == [[""2"", ""1k""]]",0.000146,2017-09-22 14:12:45 -0400,"",""
The HTTP request header field size must be limited.,"Buffer overflow attacks are carried out by a malicious attacker
  sending amounts of data that the web server cannot store in a given size
  buffer. The eventual overflow of this buffer can overwrite system memory.
  Subsequently an attacker may be able to elevate privileges and take control
  of the server. The NGINX directive client_header_buffer_size limits the
  buffer size for reading client request header thereby limiting the chances
  for a buffer overflow.",0.5,[],medium,WA000-WWA064,V-13738,SV-32766r2_rule,WA000-WWA064 A22,"[""CM-6"", ""Rev_4""]","To view the client_header_buffer_size value enter the
  following command:

  grep client_header_buffer_size on the nginx.conf file and any separate
  included configuration files

  If the value of client_header_buffer_size is not set to 1k or less, this is a
  finding. ","Edit the configuration file to set the client_header_buffer_size
  to 1k or less.","control ""V-13738"" do
  title ""The HTTP request header field size must be limited.""

  desc ""Buffer overflow attacks are carried out by a malicious attacker
  sending amounts of data that the web server cannot store in a given size
  buffer. The eventual overflow of this buffer can overwrite system memory.
  Subsequently an attacker may be able to elevate privileges and take control
  of the server. The NGINX directive """"client_header_buffer_size"""" limits the
  buffer size for reading client request header thereby limiting the chances
  for a buffer overflow. ""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WA000-WWA064""
  tag ""gid"": ""V-13738""
  tag ""rid"": ""SV-32766r2_rule""
  tag ""stig_id"": ""WA000-WWA064 A22""
  tag ""nist"": [""CM-6"", ""Rev_4""]

  tag ""check"": ""To view the client_header_buffer_size value enter the
  following command:

  grep """"client_header_buffer_size"""" on the nginx.conf file and any separate
  included configuration files

  If the value of client_header_buffer_size is not set to 1k or less, this is a
  finding. ""

  tag ""fix"": ""Edit the configuration file to set the client_header_buffer_size
  to 1k or less.""

  begin
    nginx_conf_handle = nginx_conf(NGINX_CONF_FILE)

    nginx_conf_handle.http.entries.each do |http|
      describe http.params['client_header_buffer_size'] do
        it { should_not be_nil}
      end
      describe http.params['client_header_buffer_size'].join.to_i do
        it { should cmp <= '1k'.to_i }
      end unless http.params['client_header_buffer_size'].nil?
    end

    nginx_conf_handle.servers.entries.each do |server|
      describe server.params['client_header_buffer_size'].join.to_i do
        it { should cmp <= '1k'.to_i }
      end unless server.params['client_header_buffer_size'].nil?
    end

  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-13738.rb"", ""line""=>35}",V-13738,"passed,passed","[[""1k""]] should not be nil,1 should cmp <= 1","7.9e-05,0.000143","2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400",",",","
Backup interactive scripts on the production web server are prohibited.,"Copies of backup files will not execute on the server, but they can
  be read by the anonymous user if special precautions are not taken. Such
  backup copies contain the same sensitive information as the actual script
  being executed and, as such, are useful to malicious users. Techniques and
  systems exist today that search web servers for such files and are able to
  exploit the information contained in them.",0.3,[],low,WG420,V-2230,SV-6930r1_rule,WG420 A22,"[""CM-6"", ""Rev_4""]","Search for backup copies of CGI scripts on the web server or
  ask the SA or the Web Administrator if they keep backup copies of CGI
  scripts on the web server.

  Common backup file extensions are: *.bak, *.old, *.temp, *.tmp, *.backup, .?*

  Commands to help find: find /nginx -name '.?*' -not -name .ht* -or -name '*~'
  -or -name '*

   find/usr/local/nginx/html/-name'.?*'-not-name.ht*-or-name'*~'-or-name'*.bak
   *'-or-name'*.old*'

  If files with these extensions are found in either the document directory or
  the home directory of the web server, this is a finding.

  If files with these extensions are stored in a repository (not in the document
  root) as backups for the web server, this is a finding.

  If files with these extensions have no relationship with web activity, such as
  a backup batch file for operating system utility, and they are not accessible
  by the web application, this is not a finding.  ","Ensure that CGI backup scripts are not left on the production
  web server.","control ""V-2230"" do

  title ""Backup interactive scripts on the production web server are prohibited.""

  desc  ""Copies of backup files will not execute on the server, but they can
  be read by the anonymous user if special precautions are not taken. Such
  backup copies contain the same sensitive information as the actual script
  being executed and, as such, are useful to malicious users. Techniques and
  systems exist today that search web servers for such files and are able to
  exploit the information contained in them.""

  impact 0.3
  tag ""severity"": ""low""
  tag ""gtitle"": ""WG420""
  tag ""gid"": ""V-2230""
  tag ""rid"": ""SV-6930r1_rule""
  tag ""stig_id"": ""WG420 A22""
  tag ""nist"": [""CM-6"", ""Rev_4""]

  tag ""check"": ""Search for backup copies of CGI scripts on the web server or
  ask the SA or the Web Administrator if they keep backup copies of CGI
  scripts on the web server.

  Common backup file extensions are: *.bak, *.old, *.temp, *.tmp, *.backup, .?*

  Commands to help find: find /nginx -name '.?*' -not -name .ht* -or -name '*~'
  -or -name '*

   find/usr/local/nginx/html/-name'.?*'-not-name.ht*-or-name'*~'-or-name'*.bak
   *'-or-name'*.old*'

  If files with these extensions are found in either the document directory or
  the home directory of the web server, this is a finding.

  If files with these extensions are stored in a repository (not in the document
  root) as backups for the web server, this is a finding.

  If files with these extensions have no relationship with web activity, such as
  a backup batch file for operating system utility, and they are not accessible
  by the web application, this is not a finding.  ""

  tag ""fix"": ""Ensure that CGI backup scripts are not left on the production
  web server.""

  begin
    dirs = ['/home',NGINX_BACKUP_REPOSITORY]
    nginx_conf_handle = nginx_conf(NGINX_CONF_FILE)

    nginx_conf_handle.http.entries.each do |http|
      dirs.push(http.params['root']) unless http.params['root'].nil?
    end

    nginx_conf_handle.servers.entries.each do |server|
      dirs.push(server.params['root']) unless server.params['root'].nil?
    end

    nginx_conf_handle.locations.entries.each do |location|
      dirs.push(location.params['root']) unless location.params['root'].nil?
    end

    dirs.flatten!.uniq!

    dirs.each do |dir|
      describe command(""find #{dir} -name *.bak"").stdout.chomp.split do
        it {should be_empty}
      end
      describe command(""find #{dir} -name *.old"").stdout.chomp.split do
        it {should be_empty}
      end
      describe command(""find #{dir} -name *.temp"").stdout.chomp.split do
        it {should be_empty}
      end
      describe command(""find #{dir} -name *.tmp"").stdout.chomp.split do
        it {should be_empty}
      end
      describe command(""find #{dir} -name *.backup"").stdout.chomp.split do
        it {should be_empty}
      end
      describe command(""find #{dir} -name .?*"").stdout.chomp.split do
        it {should be_empty}
      end
      describe command(""find #{dir} -name *~"").stdout.chomp.split do
        it {should be_empty}
      end
    end


  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-2230.rb"", ""line""=>41}",V-2230,"passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed","[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty,[] should be empty","0.000179,0.000186,9.0e-05,8.9e-05,0.00013,0.000124,8.8e-05,0.000106,0.000173,0.000171,0.000154,0.000193,0.000193,0.000311,0.000103,0.000179,0.000138,0.000254,0.000158,0.000151,0.0001,9.6e-05,0.000155,0.000305,0.000175,0.000115,0.000101,0.000177","2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400",",,,,,,,,,,,,,,,,,,,,,,,,,,,",",,,,,,,,,,,,,,,,,,,,,,,,,,,"
"The web server password(s) must be entrusted to the SA or Web
  Manager.","Normally, a service account is established for the web server. This is
  because a privileged account is not desirable and the server is designed to
  run for long uninterrupted periods of time. The SA or Web Manager will need
  password access to the web server to restart the service in the event of an
  emergency as the web server is not to restart automatically after an
  unscheduled interruption.If the password is not entrusted to an SA or web
  manager the ability to ensure the availability of the web server is
  compromised.",0.5,[],medium,WG050,V-2232,SV-32788r1_rule,WG050 A22,"[""AC-2"", ""Rev_4""]","The reviewer should make a note of the name of the account
  being used for the web service. This information may be needed later in the
  SRR. There may also be other server services running related to the web server
  in support of a particular web application, these passwords must be entrusted
  to the SA or Web Manager as well. Query the SA or Web Manager to determine if
  they have the web service password(s).

  If the web services password(s) are not entrusted to the SA or Web Manager,
  this is a finding.

  NOTE: For installations that run as a service, or without a password, the SA
  or Web Manager having an Admin account on the system would meet the intent of
  this check. ","Ensure the SA or Web Manager are entrusted with the web
  service(s) password.","control ""V-2232"" do

  title ""The web server password(s) must be entrusted to the SA or Web
  Manager.""

  desc ""Normally, a service account is established for the web server. This is
  because a privileged account is not desirable and the server is designed to
  run for long uninterrupted periods of time. The SA or Web Manager will need
  password access to the web server to restart the service in the event of an
  emergency as the web server is not to restart automatically after an
  unscheduled interruption.If the password is not entrusted to an SA or web
  manager the ability to ensure the availability of the web server is
  compromised.""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WG050""
  tag ""gid"": ""V-2232""
  tag ""rid"": ""SV-32788r1_rule""
  tag ""stig_id"": ""WG050 A22""
  tag ""nist"": [""AC-2"", ""Rev_4""]

  tag ""check"": ""The reviewer should make a note of the name of the account
  being used for the web service. This information may be needed later in the
  SRR. There may also be other server services running related to the web server
  in support of a particular web application, these passwords must be entrusted
  to the SA or Web Manager as well. Query the SA or Web Manager to determine if
  they have the web service password(s).

  If the web services password(s) are not entrusted to the SA or Web Manager,
  this is a finding.

  NOTE: For installations that run as a service, or without a password, the SA
  or Web Manager having an Admin account on the system would meet the intent of
  this check. ""

  tag ""fix"": ""Ensure the SA or Web Manager are entrusted with the web
  service(s) password.""


  begin
    describe passwd.users(NGINX_OWNER).passwords do
      it { should_not cmp ['']}
    end
  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-2232.rb"", ""line""=>35}",V-2232,passed,"[""x""] should not cmp == [""""]",0.000269,2017-09-22 14:12:45 -0400,"",""
Public web server resources must not be shared with private assets.,"It is important to segregate public web server resources from private
  resources located behind the DoD DMZ in order to protect private assets.
  When folders, drives or other resources are directly shared between the
  public web server and private servers the intent of data and resource
  segregation can be compromised.

  In addition to the requirements of the DoD Internet-NIPRNet DMZ STIG that
  isolates inbound traffic from the external network to the internal network,
  resources such as printers, files, and folders/directories will not be shared
  between public web servers and assets located within the internal network.",0.0,[],medium,WG040,V-2234,SV-32957r1_rule,WG040 A22,"[""SC-7"", ""Rev_4""]","Determine whether the public web server has a two-way trusted
  relationship with any private asset located within the network. Private web
  server resources (e.g., drives, folders, printers, etc.) will not be
  directly mapped to or shared with public web servers.

  If sharing is selected for any web folder, this is a finding.

  The following checks indicate inappropriate sharing of private resources with
  the public web server:

  If private resources (e.g., drives, partitions, folders/directories, printers,
  etc.) are shared with the public web server, then this is a finding. ","Configure the public web server to not have a trusted
  relationship with any system resource that is also not accessible to the
  public. Web content is not to be shared via Microsoft shares or NFS mounts.","control ""V-2234"" do

  title ""Public web server resources must not be shared with private assets.""

  desc ""It is important to segregate public web server resources from private
  resources located behind the DoD DMZ in order to protect private assets.
  When folders, drives or other resources are directly shared between the
  public web server and private servers the intent of data and resource
  segregation can be compromised.

  In addition to the requirements of the DoD Internet-NIPRNet DMZ STIG that
  isolates inbound traffic from the external network to the internal network,
  resources such as printers, files, and folders/directories will not be shared
  between public web servers and assets located within the internal network.
  ""

  impact 0.0
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WG040""
  tag ""gid"": ""V-2234""
  tag ""rid"": ""SV-32957r1_rule""
  tag ""stig_id"": ""WG040 A22""
  tag ""nist"": [""SC-7"", ""Rev_4""]

  tag ""check"": ""Determine whether the public web server has a two-way trusted
  relationship with any private asset located within the network. Private web
  server resources (e.g., drives, folders, printers, etc.) will not be
  directly mapped to or shared with public web servers.

  If sharing is selected for any web folder, this is a finding.

  The following checks indicate inappropriate sharing of private resources with
  the public web server:

  If private resources (e.g., drives, partitions, folders/directories, printers,
  etc.) are shared with the public web server, then this is a finding. ""

  tag ""fix"": ""Configure the public web server to not have a trusted
  relationship with any system resource that is also not accessible to the
  public. Web content is not to be shared via Microsoft shares or NFS mounts.""

  only_if {
    false
  }
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-2234.rb"", ""line""=>29}",V-2234,skipped,Operating System Detection,1.1e-05,2017-09-22 14:12:45 -0400,Skipped control due to only_if condition.,Operating System Detection
Installation of a compiler on production web server is prohibited.,"The presence of a compiler on a production server facilitates the
  malicious user’s task of creating custom versions of programs and installing
  Trojan Horses or viruses. For example, the attacker’s code can be uploaded
  and compiled on the server under attack.",0.5,[],medium,WG080,V-2236,SV-32956r3_rule,WG080 A22,"[""CM-6"", ""Rev_4""]","Query the SA and the Web Manager to determine if a compiler is
  present on the server.If a compiler is present, this is a finding.

  NOTE:  If the web server is part of an application suite and a compiler is
  needed for installation, patching, and upgrading of the suite or if the
  compiler is embedded and can't be removed without breaking the suite, document
  the installation of the compiler with the ISSO/ISSM and verify that the
  compiler is restricted to administrative users only.  If documented and
  restricted to administrative users, this is not a finding. ","Remove any compiler found on the production web server, but if
  the compiler program is needed to patch or upgrade an application suite in a
  production environment or the compiler is embedded and will break the suite
  if removed, document the compiler installation with the ISSO/ISSM and ensure
  that the compiler is restricted to only administrative users.","control ""V-2236"" do

  title ""Installation of a compiler on production web server is prohibited.""

  desc ""The presence of a compiler on a production server facilitates the
  malicious user’s task of creating custom versions of programs and installing
  Trojan Horses or viruses. For example, the attacker’s code can be uploaded
  and compiled on the server under attack.""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WG080""
  tag ""gid"": ""V-2236""
  tag ""rid"": ""SV-32956r3_rule""
  tag ""stig_id"": ""WG080 A22""
  tag ""nist"": [""CM-6"", ""Rev_4""]

  tag ""check"": ""Query the SA and the Web Manager to determine if a compiler is
  present on the server.If a compiler is present, this is a finding.

  NOTE:  If the web server is part of an application suite and a compiler is
  needed for installation, patching, and upgrading of the suite or if the
  compiler is embedded and can't be removed without breaking the suite, document
  the installation of the compiler with the ISSO/ISSM and verify that the
  compiler is restricted to administrative users only.  If documented and
  restricted to administrative users, this is not a finding. ""

  tag ""fix"": ""Remove any compiler found on the production web server, but if
  the compiler program is needed to patch or upgrade an application suite in a
  production environment or the compiler is embedded and will break the suite
  if removed, document the compiler installation with the ISSO/ISSM and ensure
  that the compiler is restricted to only administrative users.""

  begin
    yum_compiler_list = command('yum search all compiler').stdout.scan(/^(\S+)\s:\s/).flatten

    yum_compiler_list.each do |compiler|
      describe package(compiler) do
        it { should_not be_installed }
      end
    end

    DISALLOWED_COMPILER_LIST.each do |compiler|
      describe package(compiler) do
        it { should_not be_installed }
      end
    end

  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-2236.rb"", ""line""=>35}",V-2236,"passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed","System Package maven-compiler-plugin.noarch should not be installed,System Package maven-compiler-plugin-javadoc.noarch should not be installed,System Package ocaml-compiler-libs.x86_64 should not be installed,System Package orc-compiler.x86_64 should not be installed,System Package plexus-compiler.noarch should not be installed,System Package plexus-compiler-extras.noarch should not be installed,System Package plexus-compiler-javadoc.noarch should not be installed,System Package plexus-compiler-pom.noarch should not be installed,System Package protobuf-c-compiler.x86_64 should not be installed,System Package protobuf-compiler.i686 should not be installed,System Package protobuf-compiler.x86_64 should not be installed,System Package cal10n.noarch should not be installed,System Package checkpolicy.x86_64 should not be installed,System Package compat-gcc-44.x86_64 should not be installed,System Package compat-gcc-44-c++.x86_64 should not be installed,System Package compat-gcc-44-gfortran.x86_64 should not be installed,System Package ecj.x86_64 should not be installed,System Package gcc.x86_64 should not be installed,System Package golang-docs.noarch should not be installed,System Package golang-misc.noarch should not be installed,System Package golang-tests.noarch should not be installed,System Package ocaml.x86_64 should not be installed,System Package samba-pidl.noarch should not be installed,System Package teckit.i686 should not be installed,System Package teckit.x86_64 should not be installed,System Package teckit-devel.i686 should not be installed,System Package teckit-devel.x86_64 should not be installed,System Package xalan-j2-xsltc.noarch should not be installed,System Package antlr-tool.noarch should not be installed,System Package automoc.x86_64 should not be installed,System Package bcel.noarch should not be installed,System Package boost-build.noarch should not be installed,System Package boost-python.i686 should not be installed,System Package boost-python.x86_64 should not be installed,System Package clang.x86_64 should not be installed,System Package clang-devel.x86_64 should not be installed,System Package cmake.x86_64 should not be installed,System Package codemodel.noarch should not be installed,System Package cpp.x86_64 should not be installed,System Package gcc-c++.x86_64 should not be installed,System Package gcc-gfortran.x86_64 should not be installed,System Package gcc-gnat.x86_64 should not be installed,System Package gcc-go.x86_64 should not be installed,System Package golang-bin.x86_64 should not be installed,System Package golang-src.noarch should not be installed,System Package javacc.noarch should not be installed,System Package libffi.i686 should not be installed,System Package libffi.x86_64 should not be installed,System Package libsemanage.i686 should not be installed,System Package libsemanage.x86_64 should not be installed,System Package libsepol.i686 should not be installed,System Package libsepol.x86_64 should not be installed,System Package llvm.x86_64 should not be installed,System Package llvm-doc.noarch should not be installed,System Package llvm-libs.x86_64 should not be installed,System Package llvm-static.x86_64 should not be installed,System Package ncurses.x86_64 should not be installed,System Package netsniff-ng.x86_64 should not be installed,System Package orc.i686 should not be installed,System Package orc.x86_64 should not be installed,System Package perl-ExtUtils-CBuilder.noarch should not be installed,System Package perl-Filter.x86_64 should not be installed,System Package perl-Package-Stash-XS.x86_64 should not be installed,System Package perl-Parse-Yapp.noarch should not be installed,System Package pkgconfig.i686 should not be installed,System Package pkgconfig.x86_64 should not be installed,System Package protobuf-devel.i686 should not be installed,System Package protobuf-devel.x86_64 should not be installed,System Package protobuf-lite.i686 should not be installed,System Package protobuf-lite.x86_64 should not be installed,System Package protobuf-lite-devel.i686 should not be installed,System Package protobuf-lite-devel.x86_64 should not be installed,System Package protobuf-lite-static.i686 should not be installed,System Package protobuf-lite-static.x86_64 should not be installed,System Package qt3-devel.i686 should not be installed,System Package qt3-devel.x86_64 should not be installed,System Package relaxngcc.noarch should not be installed,System Package vala.i686 should not be installed,System Package vala.x86_64 should not be installed,System Package vala-devel.i686 should not be installed,System Package vala-devel.x86_64 should not be installed,System Package ws-jaxme.noarch should not be installed","0.204002,0.19625,0.192731,0.182606,0.180376,0.193203,0.202912,0.18345,0.19152,0.183954,0.190892,0.21971,0.285565,0.208997,0.197169,0.184967,0.190152,0.186674,0.192955,0.186996,0.19237,0.219236,0.177088,0.248101,0.249544,0.219294,0.207249,0.203836,0.189615,0.187856,0.177579,0.206171,0.201613,0.174389,0.188197,0.219018,0.233543,0.19259,0.191169,0.187088,0.177965,0.177524,0.200122,0.224601,0.198211,0.196832,0.187802,0.179939,0.201244,0.218479,0.18915,0.189282,0.191381,0.191281,0.254814,0.214648,0.198159,0.181901,0.196094,0.175049,0.174425,0.254994,0.23653,0.1849,0.188058,0.178005,0.189291,0.188582,0.191269,0.178058,0.197542,0.183488,0.190882,0.194238,0.177709,0.175524,0.190007,0.18638,0.180397,0.190114,0.18049,0.180142","2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:45 -0400,2017-09-22 14:12:46 -0400,2017-09-22 14:12:46 -0400,2017-09-22 14:12:46 -0400,2017-09-22 14:12:46 -0400,2017-09-22 14:12:46 -0400,2017-09-22 14:12:47 -0400,2017-09-22 14:12:47 -0400,2017-09-22 14:12:47 -0400,2017-09-22 14:12:47 -0400,2017-09-22 14:12:47 -0400,2017-09-22 14:12:48 -0400,2017-09-22 14:12:48 -0400,2017-09-22 14:12:48 -0400,2017-09-22 14:12:48 -0400,2017-09-22 14:12:48 -0400,2017-09-22 14:12:49 -0400,2017-09-22 14:12:49 -0400,2017-09-22 14:12:49 -0400,2017-09-22 14:12:49 -0400,2017-09-22 14:12:49 -0400,2017-09-22 14:12:50 -0400,2017-09-22 14:12:50 -0400,2017-09-22 14:12:50 -0400,2017-09-22 14:12:50 -0400,2017-09-22 14:12:50 -0400,2017-09-22 14:12:51 -0400,2017-09-22 14:12:51 -0400,2017-09-22 14:12:51 -0400,2017-09-22 14:12:51 -0400,2017-09-22 14:12:51 -0400,2017-09-22 14:12:52 -0400,2017-09-22 14:12:52 -0400,2017-09-22 14:12:52 -0400,2017-09-22 14:12:52 -0400,2017-09-22 14:12:52 -0400,2017-09-22 14:12:53 -0400,2017-09-22 14:12:53 -0400,2017-09-22 14:12:53 -0400,2017-09-22 14:12:53 -0400,2017-09-22 14:12:53 -0400,2017-09-22 14:12:54 -0400,2017-09-22 14:12:54 -0400,2017-09-22 14:12:54 -0400,2017-09-22 14:12:54 -0400,2017-09-22 14:12:54 -0400,2017-09-22 14:12:55 -0400,2017-09-22 14:12:55 -0400,2017-09-22 14:12:55 -0400,2017-09-22 14:12:55 -0400,2017-09-22 14:12:55 -0400,2017-09-22 14:12:56 -0400,2017-09-22 14:12:56 -0400,2017-09-22 14:12:56 -0400,2017-09-22 14:12:56 -0400,2017-09-22 14:12:56 -0400,2017-09-22 14:12:57 -0400,2017-09-22 14:12:57 -0400,2017-09-22 14:12:57 -0400,2017-09-22 14:12:57 -0400,2017-09-22 14:12:57 -0400,2017-09-22 14:12:58 -0400,2017-09-22 14:12:58 -0400,2017-09-22 14:12:58 -0400,2017-09-22 14:12:58 -0400,2017-09-22 14:12:58 -0400,2017-09-22 14:12:59 -0400,2017-09-22 14:12:59 -0400,2017-09-22 14:12:59 -0400,2017-09-22 14:12:59 -0400,2017-09-22 14:12:59 -0400,2017-09-22 14:13:00 -0400,2017-09-22 14:13:00 -0400,2017-09-22 14:13:00 -0400,2017-09-22 14:13:00 -0400,2017-09-22 14:13:00 -0400,2017-09-22 14:13:00 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400",",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,",",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"
"A public web server, if hosted on the NIPRNet, must be isolated in an
  accredited DoD DMZ Extension.","To minimize exposure of private assets to unnecessary risk by
  attackers, public web servers must be isolated from internal systems.Public
  web servers are by nature more vulnerable to attack from publically based
  sources, such as the public Internet. Once compromised, a public web server
  might be used as a base for further attack on private resources, unless
  additional layers of protection are implemented. Public web servers must be
  located in a DoD DMZ Extension, if hosted on the NIPRNet, with carefully
  controlled access. Failure to isolate resources in this way increase risk
  that private assets are exposed to attacks from public sources.",0.5,[],medium,WA060,V-2242,SV-32932r2_rule,WA060 A22,"[""SC-7"", ""Rev_4""]","Interview the SA or web administrator to see where the public
  web server is logically located in the data center. Review the site’s
  network diagram to see how the web server is connected to the LAN. Visually
  check the web server hardware connections to see if it conforms to the
  site’s network diagram. An improperly located public web server is a
  potential threat to the entire network.If the web server is not isolated in
  an accredited DoD DMZ Extension, this is a finding.","Logically relocate the public web server to be isolated from
  internal systems. In addition, ensure the public web server does not have
  trusted connections with assets outside the confines of the demilitarized
  zone (DMZ) other than application and/or database servers that are a part of
  the same system as the web server.","control ""V-2242"" do

  title ""A public web server, if hosted on the NIPRNet, must be isolated in an
  accredited DoD DMZ Extension.""

  desc ""To minimize exposure of private assets to unnecessary risk by
  attackers, public web servers must be isolated from internal systems.Public
  web servers are by nature more vulnerable to attack from publically based
  sources, such as the public Internet. Once compromised, a public web server
  might be used as a base for further attack on private resources, unless
  additional layers of protection are implemented. Public web servers must be
  located in a DoD DMZ Extension, if hosted on the NIPRNet, with carefully
  controlled access. Failure to isolate resources in this way increase risk
  that private assets are exposed to attacks from public sources.""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WA060""
  tag ""gid"": ""V-2242""
  tag ""rid"": ""SV-32932r2_rule""
  tag ""stig_id"": ""WA060 A22""
  tag ""nist"": [""SC-7"", ""Rev_4""]

  tag ""check"": ""Interview the SA or web administrator to see where the public
  web server is logically located in the data center. Review the site’s
  network diagram to see how the web server is connected to the LAN. Visually
  check the web server hardware connections to see if it conforms to the
  site’s network diagram. An improperly located public web server is a
  potential threat to the entire network.If the web server is not isolated in
  an accredited DoD DMZ Extension, this is a finding.""

  tag ""fix"": ""Logically relocate the public web server to be isolated from
  internal systems. In addition, ensure the public web server does not have
  trusted connections with assets outside the confines of the demilitarized
  zone (DMZ) other than application and/or database servers that are a part of
  the same system as the web server.""

  only_if {
    false
  }

end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-2242.rb"", ""line""=>29}",V-2242,skipped,Operating System Detection,8.0e-06,2017-09-22 14:13:01 -0400,Skipped control due to only_if condition.,Operating System Detection
"A private web server must be located on a separate controlled access
  subnet.","Private web servers, which host sites that serve controlled access
  data, must be protected from outside threats in addition to insider threats.
  Insider threat may be accidental or intentional but, in either case, can
  cause a disruption in service of the web server. To protect the private web
  server from these threats, it must be located on a separate controlled
  access subnet and must not be a part of the public DMZ that houses the
  public web servers. It also cannot be located inside the enclave as part of
  the local general population LAN.",0.5,[],medium,WA070,V-2243,SV-32935r1_rule,WA070 A22,"[""SC-7"", ""Rev_4""]","Verify the site’s network diagram and visually check the web
  server, to ensure that the private web server is located on a separate
  controlled access subnet and is not a part of the public DMZ that houses the
  public web servers. In addition, the private web server needs to be isolated
  via a controlled access mechanism from the local general population LAN.","Isolate the private web server from the public DMZ and separate
  it from the internal general population LAN.","control ""V-2243"" do

  title ""A private web server must be located on a separate controlled access
  subnet.""

  desc ""Private web servers, which host sites that serve controlled access
  data, must be protected from outside threats in addition to insider threats.
  Insider threat may be accidental or intentional but, in either case, can
  cause a disruption in service of the web server. To protect the private web
  server from these threats, it must be located on a separate controlled
  access subnet and must not be a part of the public DMZ that houses the
  public web servers. It also cannot be located inside the enclave as part of
  the local general population LAN.""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WA070""
  tag ""gid"": ""V-2243""
  tag ""rid"": ""SV-32935r1_rule""
  tag ""stig_id"": ""WA070 A22""
  tag ""nist"": [""SC-7"", ""Rev_4""]

  tag ""check"": ""Verify the site’s network diagram and visually check the web
  server, to ensure that the private web server is located on a separate
  controlled access subnet and is not a part of the public DMZ that houses the
  public web servers. In addition, the private web server needs to be isolated
  via a controlled access mechanism from the local general population LAN.""

  tag ""fix"": ""Isolate the private web server from the public DMZ and separate
  it from the internal general population LAN.""

  require ""ipaddr""

  # collect and test each listen IPs from nginx_conf

  begin
    nginx_conf_handle = nginx_conf(NGINX_CONF_FILE)

    nginx_conf_handle.servers.entries.each do |server|
      server.params['listen'].each do |listen|
        describe listen.join do
          it { should match %r([0-9]+(?:\.[0-9]+){3}|[a-zA-Z]:[0-9]+) }
        end
        server_ip = listen.join.split(':').first
        server_ip = server_ip.eql?('localhost') ? '127.0.0.1' : server_ip

        describe IPAddr.new(DMZ_SUBNET) === IPAddr.new(server_ip) do
          it { should be false}
        end unless (IPAddr.new(server_ip) rescue nil).nil?

      end unless server.params['listen'].nil?
    end

  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-2243.rb"", ""line""=>42}",V-2243,"passed,passed","localhost:80 should match /[0-9]+(?:\.[0-9]+){3}|[a-zA-Z]:[0-9]+/,false should equal false","0.001089,0.00013","2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400",",",","
Web server software must be a vendor-supported version.,"Many vulnerabilities are associated with older versions of
  web server   software. As hot fixes and patches are issued, these solutions
  are included   in the next version of the server software. Maintaining the web
  server at a   current version makes the efforts of a malicious user to exploit
  the web   service more difficult.",0.7,[],high,WG190,V-2246,SV-36441r2_rule,WG190 A22,"[""CM-6"", ""Rev_4""]","To determine the version of the nginx software that is running
  on the system. Use the command:

  nginx -v

  If the version of nginx is not at the following version or higher, this is a
  finding.

  nginx version: nginx/1.12.0

  Note: In some situations, the nginx software that is being used is supported
  by another vendor, such as nginx.com.  The versions of the software in these
  cases may not match the above mentioned version numbers. If the site can
  provide vendor documentation showing the version of the web server is
  supported, this would not be a finding. ","Install the current version of the web server software and
  maintain appropriate service packs and patches.","control ""V-2246"" do
  title ""Web server software must be a vendor-supported version.""
  desc ""Many vulnerabilities are associated with older versions of
  web server   software. As hot fixes and patches are issued, these solutions
  are included   in the next version of the server software. Maintaining the web
  server at a   current version makes the efforts of a malicious user to exploit
  the web   service more difficult.""
  impact 0.7
  tag ""severity"": ""high""
  tag ""gtitle"": ""WG190""
  tag ""gid"": ""V-2246""
  tag ""rid"": ""SV-36441r2_rule""
  tag ""stig_id"": ""WG190 A22""
  tag ""nist"": [""CM-6"", ""Rev_4""]

  tag ""check"": ""To determine the version of the nginx software that is running
  on the system. Use the command:

  nginx -v

  If the version of nginx is not at the following version or higher, this is a
  finding.

  nginx version: nginx/1.12.0

  Note: In some situations, the nginx software that is being used is supported
  by another vendor, such as nginx.com.  The versions of the software in these
  cases may not match the above mentioned version numbers. If the site can
  provide vendor documentation showing the version of the web server is
  supported, this would not be a finding. ""

  tag ""fix"": ""Install the current version of the web server software and
  maintain appropriate service packs and patches.""

  begin
    describe nginx do
      its('version'){ should cmp >= NGINX_MIN_VER }
    end
  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-2246.rb"", ""line""=>43}",V-2246,passed,"Nginx Environment version should cmp >= ""1.12.0""",0.000228,2017-09-22 14:13:01 -0400,"",""
"Administrators must be the only users allowed access to the directory
  tree, the shell, or other operating system functions and utilities.","As a rule, accounts on a web server are to be kept to a minimum. Only
  administrators, web managers, developers, auditors, and web authors require
  accounts on the machine hosting the web server. This is in addition to the
  anonymous web user account. The resources to which these accounts have
  access must also be closely monitored and controlled. Only the SA needs
  access to all the system’s capabilities, while the web administrator and
  associated staff require access and control of the web content and web
  server configuration files. The anonymous web user account must not have
  access to system resources as that account could then control the server.",0.7,[],high,WG200,V-2247,SV-36456r2_rule,WG200 A22,"[""AC-6"", ""Rev_4""]","Obtain a list of the user accounts for the system, noting the
  priviledges for each account.

  Verify with the system administrator or the ISSO that all privileged accounts
  are mission essential and documented.

  Verify with the system administrator or the ISSO that all non-administrator
  access to shell scripts and operating system functions are mission essential
  and documented.

  If undocumented privileged accounts are found, this is a finding.

  If undocumented access to shell scripts or operating system functions is
  found, this is a finding.","Ensure non-administrators are not allowed access to the
  directory tree, the shell, or other operating system functions and
  utilities.","control ""V-2247"" do

  title ""Administrators must be the only users allowed access to the directory
  tree, the shell, or other operating system functions and utilities.""

  desc ""As a rule, accounts on a web server are to be kept to a minimum. Only
  administrators, web managers, developers, auditors, and web authors require
  accounts on the machine hosting the web server. This is in addition to the
  anonymous web user account. The resources to which these accounts have
  access must also be closely monitored and controlled. Only the SA needs
  access to all the system’s capabilities, while the web administrator and
  associated staff require access and control of the web content and web
  server configuration files. The anonymous web user account must not have
  access to system resources as that account could then control the server.""

  impact 0.7
  tag ""severity"": ""high""
  tag ""gtitle"": ""WG200""
  tag ""gid"": ""V-2247""
  tag ""rid"": ""SV-36456r2_rule""
  tag ""stig_id"": ""WG200 A22""
  tag ""nist"": [""AC-6"", ""Rev_4""]

  tag ""check"": ""Obtain a list of the user accounts for the system, noting the
  priviledges for each account.

  Verify with the system administrator or the ISSO that all privileged accounts
  are mission essential and documented.

  Verify with the system administrator or the ISSO that all non-administrator
  access to shell scripts and operating system functions are mission essential
  and documented.

  If undocumented privileged accounts are found, this is a finding.

  If undocumented access to shell scripts or operating system functions is
  found, this is a finding.""

  tag ""fix"": ""Ensure non-administrators are not allowed access to the
  directory tree, the shell, or other operating system functions and
  utilities.""



  begin
    users.shells(/bash/).usernames.each do |account|
      describe account do
        it { should match %r(#{SYS_ADMIN}|#{NGINX_OWNER}) }
      end
    end

    if users.shells(/bash/).usernames.empty?
      describe do
        skip ""Skipped: no users found with shell acccess.""
      end
    end
  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-2247.rb"", ""line""=>41}",V-2247,passed,root should match /root|nginx/,0.000114,2017-09-22 14:13:01 -0400,"",""
"Web administration tools must be restricted to the web manager and
  the web manager’s designees.","All automated information systems are at risk of data loss due to
  disaster or compromise. Failure to provide adequate protection to the
  administration tools creates risk of potential theft or damage that may
  ultimately compromise the mission.Adequate protection ensures that server
  administration operates with less risk of losses or operations outages.The
  key web service administrative and configuration tools must be accessible
  only by the authorized web server administrators. All users granted this
  authority must be documented and approved by the ISSO. Access to the IIS
  Manager will be limited to authorized users and administrators.",0.5,[],medium,WG220,V-2248,SV-32948r2_rule,WG220 A22,"[""AC-3"", ""AC-6"", ""Rev_4""]","Determine which tool or control file is used to control the
  configuration of the web server.

  If the control of the web server is done via control files, verify who has
  update access to them. If tools are being used to configure the web server,
  determine who has access to execute the tools.

  If accounts other than the SA, the web manager, or the web manager designees
  have access to the web administration tool or control files, this is a
  finding. ","Determine which tool or control file is used to control the
  configuration of the web server.

  If the control of the web server is done via control files, verify who has
  update access to them. If tools are being used to configure the web server,
  determine who has access to execute the tools.

  If accounts other than the SA, the web manager, or the web manager designees
  have access to the web administration tool or control files, this is a
  finding. ","control ""V-2248"" do

  title ""Web administration tools must be restricted to the web manager and
  the web manager’s designees.""

  desc""All automated information systems are at risk of data loss due to
  disaster or compromise. Failure to provide adequate protection to the
  administration tools creates risk of potential theft or damage that may
  ultimately compromise the mission.Adequate protection ensures that server
  administration operates with less risk of losses or operations outages.The
  key web service administrative and configuration tools must be accessible
  only by the authorized web server administrators. All users granted this
  authority must be documented and approved by the ISSO. Access to the IIS
  Manager will be limited to authorized users and administrators.""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WG220""
  tag ""gid"": ""V-2248""
  tag ""rid"": ""SV-32948r2_rule""
  tag ""stig_id"": ""WG220 A22""
  tag ""nist"": [""AC-3"", ""AC-6"", ""Rev_4""]

  tag ""check"": ""Determine which tool or control file is used to control the
  configuration of the web server.

  If the control of the web server is done via control files, verify who has
  update access to them. If tools are being used to configure the web server,
  determine who has access to execute the tools.

  If accounts other than the SA, the web manager, or the web manager designees
  have access to the web administration tool or control files, this is a
  finding. ""

  tag ""fix"": ""Determine which tool or control file is used to control the
  configuration of the web server.

  If the control of the web server is done via control files, verify who has
  update access to them. If tools are being used to configure the web server,
  determine who has access to execute the tools.

  If accounts other than the SA, the web manager, or the web manager designees
  have access to the web administration tool or control files, this is a
  finding. ""

  begin
    nginx_conf_handle = nginx_conf(NGINX_CONF_FILE)
    nginx_conf_handle.params

    nginx_conf_handle.contents.keys.each do |file|
      describe file(file) do
        its('owner') { should match %r(#{SYS_ADMIN}|#{NGINX_OWNER}) }
        its('group') { should match %r(#{SYS_ADMIN_GROUP}|#{NGINX_GROUP}) }
        its('mode')  { should cmp <= 0660 }
      end
    end

    if nginx_conf_handle.contents.keys.empty?
      describe do
        skip ""Skipped: no conf files included.""
      end
    end
  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-2248.rb"", ""line""=>59}",V-2248,"passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed","File /etc/nginx/nginx.conf owner should match /root|nginx/,File /etc/nginx/nginx.conf group should match /root|nginx/,File /etc/nginx/nginx.conf mode should cmp <= 432,File /etc/nginx/mime.types owner should match /root|nginx/,File /etc/nginx/mime.types group should match /root|nginx/,File /etc/nginx/mime.types mode should cmp <= 432,File /etc/nginx/conf.d/90.hardening.conf owner should match /root|nginx/,File /etc/nginx/conf.d/90.hardening.conf group should match /root|nginx/,File /etc/nginx/conf.d/90.hardening.conf mode should cmp <= 432,File /etc/nginx/sites-enabled/vserver1.conf owner should match /root|nginx/,File /etc/nginx/sites-enabled/vserver1.conf group should match /root|nginx/,File /etc/nginx/sites-enabled/vserver1.conf mode should cmp <= 432","0.000108,0.000101,0.000163,0.000145,9.6e-05,0.000144,0.000101,0.000264,0.000167,9.9e-05,9.4e-05,0.000203","2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400",",,,,,,,,,,,",",,,,,,,,,,,"
"All utility programs, not necessary for operations, must be removed
  or disabled. ","Just as running unneeded services and protocols is a danger to the
  web server at the lower levels of the OSI model, running unneeded utilities
  and programs is also a danger at the application layer of the OSI model.
  Office suites, development tools, and graphical editors are examples of such
  programs that are troublesome. Individual productivity tools have no
  legitimate place or use on an enterprise, production web server and they are
  also prone to their own security risks.",0.3,[],low,WG130,V-2251,SV-32955r2_rule,WG130 A22,"[""CM-6"", ""Rev_4""]","If the site requires the use of a particular piece of
  software, the ISSO will need to maintain documentation identifying this
  software as necessary for operations. The software must be operated at the
  vendor’s current patch level and must be a supported vendor release. If
  programs or utilities that meet the above criteria are installed on the Web
  Server, and appropriate documentation and signatures are in evidence, this is
  not a finding.

  Determine whether the web server is configured with unnecessary software.

  Determine whether processes other than those that support the web server are
  loaded and/or run on the web server.

  Examples of software that should not be on the web server are all web
  development tools, office suites (unless the web server is a private web
  development server), compilers, and other utilities that are not part of the
  web server suite or the basic operating system.

  Check the directory structure of the server and ensure that additional,
  unintended, or unneeded applications are not loaded on the system.

  If, after review of the application on the system, there is no justification
  for the identified software, this is a finding.  ",Remove any unnecessary applications.,"control ""V-2251"" do

  title ""All utility programs, not necessary for operations, must be removed
  or disabled. ""

  desc  ""Just as running unneeded services and protocols is a danger to the
  web server at the lower levels of the OSI model, running unneeded utilities
  and programs is also a danger at the application layer of the OSI model.
  Office suites, development tools, and graphical editors are examples of such
  programs that are troublesome. Individual productivity tools have no
  legitimate place or use on an enterprise, production web server and they are
  also prone to their own security risks.""

  impact 0.3
  tag ""severity"": ""low""
  tag ""gtitle"": ""WG130""
  tag ""gid"": ""V-2251""
  tag ""rid"": ""SV-32955r2_rule""
  tag ""stig_id"": ""WG130 A22""
  tag ""nist"": [""CM-6"", ""Rev_4""]

  tag ""check"": ""If the site requires the use of a particular piece of
  software, the ISSO will need to maintain documentation identifying this
  software as necessary for operations. The software must be operated at the
  vendor’s current patch level and must be a supported vendor release. If
  programs or utilities that meet the above criteria are installed on the Web
  Server, and appropriate documentation and signatures are in evidence, this is
  not a finding.

  Determine whether the web server is configured with unnecessary software.

  Determine whether processes other than those that support the web server are
  loaded and/or run on the web server.

  Examples of software that should not be on the web server are all web
  development tools, office suites (unless the web server is a private web
  development server), compilers, and other utilities that are not part of the
  web server suite or the basic operating system.

  Check the directory structure of the server and ensure that additional,
  unintended, or unneeded applications are not loaded on the system.

  If, after review of the application on the system, there is no justification
  for the identified software, this is a finding.  ""

  tag ""fix"": ""Remove any unnecessary applications.""


  begin
    ps_list = command('ps -A').stdout.scan(/[0-9][0-9]:[0-9][0-9]:[0-9][0-9]\s(.+)/).flatten.uniq

    describe ps_list do
      it { should be_in AUTHORIZED_PROCESS_LIST}
    end

    if ps_list.empty?
      describe do
        skip ""Skipped: no processes parsed.""
      end
    end

  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-2251.rb"", ""line""=>44}",V-2251,passed,"[""systemd"", ""systemd-journal"", ""systemd-udevd"", ""dbus-daemon"", ""systemd-logind"", ""nginx"", ""agetty"", ""ps""] should be in ""nginx"", ""systemd"", ""systemd-journal"", ""systemd-udevd"", ""systemd-logind"", ""dbus-daemon"", ""agetty"", ""bash"", and ""ps""",0.000212,2017-09-22 14:13:01 -0400,"",""
"The web server’s htpasswd files (if present) must reflect proper
  ownership and permissions","In addition to OS restrictions, access rights to files and directories
  can be set on a web site using the web server software.That is, in addition
  to allowing or denying all access rights, a rule can be specified that
  allows or denies partial access rights.For example, users can be given read-
  only access rights to files, to view the information but not change the
  files.

  This check verifies that the htpasswd file is only accessible by system
  administrators or web managers, with the account running the web service
  having group permissions of read and execute.  htpasswd is a utility used to
  provide for password access to web sites.",0.5,[],medium,WG270,V-2255,SV-36478r2_rule,WG270 A22,"[""AC-3"", ""Rev_4""]","To locate the htpasswd file enter the following command:

  Find / -name htpasswd Permissions should be r-x r - x - - - (550)

  If permissions on htpasswd are greater than 550, this is a finding.

  Owner should be the SA or Web Manager account, if another account has access
  to this file, this is a finding. ","The SA or Web Manager account
  should own the htpasswd file and permissions should be set to 550.","control ""V-2255"" do

  title ""The web server’s htpasswd files (if present) must reflect proper
  ownership and permissions""

  desc ""In addition to OS restrictions, access rights to files and directories
  can be set on a web site using the web server software.That is, in addition
  to allowing or denying all access rights, a rule can be specified that
  allows or denies partial access rights.For example, users can be given read-
  only access rights to files, to view the information but not change the
  files.

  This check verifies that the htpasswd file is only accessible by system
  administrators or web managers, with the account running the web service
  having group permissions of read and execute.  htpasswd is a utility used to
  provide for password access to web sites.""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WG270""
  tag ""gid"": ""V-2255""
  tag ""rid"": ""SV-36478r2_rule""
  tag ""stig_id"": ""WG270 A22""
  tag ""nist"": [""AC-3"", ""Rev_4""]
  tag ""check"": ""To locate the htpasswd file enter the following command:

  Find / -name htpasswd Permissions should be r-x r - x - - - (550)

  If permissions on htpasswd are greater than 550, this is a finding.

  Owner should be the SA or Web Manager account, if another account has access
  to this file, this is a finding. ""

  tag ""fix"": ""The SA or Web Manager account
  should own the htpasswd file and permissions should be set to 550.""

  begin
    htpasswd = command('find / -name .htpasswd').stdout.chomp
    htpasswd.split.each do |htpwd|
      describe file(htpwd) do
        its('mode') { should cmp <= 0550 }
      end
      describe file(htpwd) do
        its('owner') { should match %r(#{SYS_ADMIN}|#{NGINX_OWNER}) }
        its('group') { should match %r(#{SYS_ADMIN_GROUP}|#{NGINX_GROUP}) }
      end
    end

    if htpasswd.empty?
      describe do
        skip ""Skipped: .htpasswd file not found""
      end
    end

  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-2255.rb"", ""line""=>53}",V-2255,skipped,"{""file_path""=>""/usr/local/lib/ruby/gems/2.4.0/gems/inspec-1.37.6/lib/inspec/rule.rb"", ""line_number""=>223}",7.0e-06,2017-09-22 14:13:01 -0400,Skipped: .htpasswd file not found,"{""file_path""=>""/usr/local/lib/ruby/gems/2.4.0/gems/inspec-1.37.6/lib/inspec/rule.rb"", ""line_number""=>223}"
The access control files are owned by a privileged web server account.,"This check verifies that the key web server system configuration files
 are owned by the SA or Web Manager controlled account. These same files
 which control the configuration of the web server, and thus its behavior,
 must also be accessible by the account which runs the web service. If these
 files are altered by a malicious user, the web server would no longer be
 under the control of its managers and owners; properties in the web server
 configuration could be altered to compromise the entire server platform.",0.5,[],medium,WG280,V-2256,SV-6880r1_rule,WG280,"[""AC-3"", ""Rev_4""]","This check verifies that the SA or Web Manager controlled
  account owns the key web server files. These same files, which control the
  configuration of the web server, and thus its behavior, must also be
  accessible by the account that runs the web service process.

  If it exists, the following file need to be owned by a privileged account.

  .htaccess .htpasswd nginx.conf and its included configuration files

  Use the command find / -name nginx.conf to find the file.  grep include on
  the nginx.conf file to identify included configuration files. Change to the
  directories that contain the nginx.conf and included configuration files. Use
  the command ls -l on these files to determine ownership of the file

  -The Web Manager or the SA should own all the system files and directories.
  -The configurable directories can be owned by the WebManager or equivalent
  -user.

  Permissions on these files should be 660 or more restrictive.

  If root or an authorized user does not own the web system files and the
  permission are not correct, this is a finding.","The site needs to ensure that the owner should be the non-
  privileged web server account or equivalent which runs the web service;
  however, the group permissions represent those of the user accessing the web
  site that must execute the directives in .htacces.","control ""V-2256"" do
  title ""The access control files are owned by a privileged web server account.""

  desc "" This check verifies that the key web server system configuration files
  are owned by the SA or Web Manager controlled account. These same files
  which control the configuration of the web server, and thus its behavior,
  must also be accessible by the account which runs the web service. If these
  files are altered by a malicious user, the web server would no longer be
  under the control of its managers and owners; properties in the web server
  configuration could be altered to compromise the entire server platform.""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WG280""
  tag ""gid"": ""V-2256""
  tag ""rid"": ""SV-6880r1_rule""
  tag ""stig_id"": ""WG280""
  tag ""nist"": [""AC-3"", ""Rev_4""]

  tag ""check"": ""This check verifies that the SA or Web Manager controlled
  account owns the key web server files. These same files, which control the
  configuration of the web server, and thus its behavior, must also be
  accessible by the account that runs the web service process.

  If it exists, the following file need to be owned by a privileged account.

  .htaccess .htpasswd nginx.conf and its included configuration files

  Use the command find / -name nginx.conf to find the file.  grep """"include"""" on
  the nginx.conf file to identify included configuration files. Change to the
  directories that contain the nginx.conf and included configuration files. Use
  the command ls -l on these files to determine ownership of the file

  -The Web Manager or the SA should own all the system files and directories.
  -The configurable directories can be owned by the WebManager or equivalent
  -user.

  Permissions on these files should be 660 or more restrictive.

  If root or an authorized user does not own the web system files and the
  permission are not correct, this is a finding.""

  tag ""fix"": ""The site needs to ensure that the owner should be the non-
  privileged web server account or equivalent which runs the web service;
  however, the group permissions represent those of the user accessing the web
  site that must execute the directives in .htacces.""

  begin
    access_control_files = [ '.htaccess',
                            '.htpasswd']
    nginx_conf_handle = nginx_conf(NGINX_CONF_FILE)
    nginx_conf_handle.params

    access_control_files.each do |file|
      file_path = command(""find / -name #{file}"").stdout.chomp

      if file_path.empty?
        describe do
          skip ""Skipped: Access control file #{file} not found""
        end
      end

      file_path.split.each do |file|
        describe file(file) do
          its('owner') { should match %r(#{SYS_ADMIN}|#{NGINX_OWNER}) }
          its('group') { should match %r(#{SYS_ADMIN_GROUP}|#{NGINX_GROUP}) }
          its('mode')  { should cmp <= 0660 }
        end
      end
    end

    nginx_conf_handle.contents.keys.each do |file|
      describe file(file) do
        its('owner') { should match %r(#{SYS_ADMIN}|#{NGINX_OWNER}) }
        its('group') { should match %r(#{SYS_ADMIN_GROUP}|#{NGINX_GROUP}) }
        its('mode')  { should cmp <= 0660 }
      end
    end

    if nginx_conf_handle.contents.keys.empty?
      describe do
        skip ""Skipped: no conf files included.""
      end
    end

    webserver_roots = []

    nginx_conf_handle.http.entries.each do |http|
      webserver_roots.push(http.params['root']) unless http.params['root'].nil?
    end

    nginx_conf_handle.servers.entries.each do |server|
      webserver_roots.push(server.params['root']) unless server.params['root'].nil?
    end

    nginx_conf_handle.locations.entries.each do |location|
      webserver_roots.push(location.params['root']) unless location.params['root'].nil?
    end

    webserver_roots.flatten!.uniq!

    webserver_roots.each do |directory|
      describe file(directory) do
        its('owner') { should match %r(#{SYS_ADMIN}|#{NGINX_OWNER}) }
        its('group') { should match %r(#{SYS_ADMIN_GROUP}|#{NGINX_GROUP}) }
        its('sticky'){ should be true }
      end
    end

    if webserver_roots.empty?
      describe do
        skip ""Skipped: no web root directories found.""
      end
    end

  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end

end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-2256.rb"", ""line""=>60}",V-2256,"skipped,skipped,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed","{""file_path""=>""/usr/local/lib/ruby/gems/2.4.0/gems/inspec-1.37.6/lib/inspec/rule.rb"", ""line_number""=>223},{""file_path""=>""/usr/local/lib/ruby/gems/2.4.0/gems/inspec-1.37.6/lib/inspec/rule.rb"", ""line_number""=>223},File /etc/nginx/nginx.conf owner should match /root|nginx/,File /etc/nginx/nginx.conf group should match /root|nginx/,File /etc/nginx/nginx.conf mode should cmp <= 432,File /etc/nginx/mime.types owner should match /root|nginx/,File /etc/nginx/mime.types group should match /root|nginx/,File /etc/nginx/mime.types mode should cmp <= 432,File /etc/nginx/conf.d/90.hardening.conf owner should match /root|nginx/,File /etc/nginx/conf.d/90.hardening.conf group should match /root|nginx/,File /etc/nginx/conf.d/90.hardening.conf mode should cmp <= 432,File /etc/nginx/sites-enabled/vserver1.conf owner should match /root|nginx/,File /etc/nginx/sites-enabled/vserver1.conf group should match /root|nginx/,File /etc/nginx/sites-enabled/vserver1.conf mode should cmp <= 432,File /usr/share/nginx/html/app1 owner should match /root|nginx/,File /usr/share/nginx/html/app1 group should match /root|nginx/,File /usr/share/nginx/html/app1 sticky should equal true,File /usr/share/nginx/html/app2 owner should match /root|nginx/,File /usr/share/nginx/html/app2 group should match /root|nginx/,File /usr/share/nginx/html/app2 sticky should equal true","5.0e-06,5.0e-06,0.000118,9.6e-05,0.000154,9.7e-05,0.000124,0.000139,9.4e-05,0.000127,0.000149,0.000105,9.3e-05,0.000252,0.074648,0.000159,0.000135,0.06638,0.000192,0.000184","2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400","Skipped: Access control file .htaccess not found,Skipped: Access control file .htpasswd not found,,,,,,,,,,,,,,,,,,","{""file_path""=>""/usr/local/lib/ruby/gems/2.4.0/gems/inspec-1.37.6/lib/inspec/rule.rb"", ""line_number""=>223},{""file_path""=>""/usr/local/lib/ruby/gems/2.4.0/gems/inspec-1.37.6/lib/inspec/rule.rb"", ""line_number""=>223},,,,,,,,,,,,,,,,,,"
"Administrative users and groups that have access rights to the web
  server must be documented.","There are typically several individuals and groups that are involved in
  running a production web server.These accounts must be restricted to only
  those necessary to maintain web services, review the server’s operation, and
  the operating system.By minimizing the amount of user and group accounts on
  a web server the total attack surface of the server is
  minimized.Additionally, if the required accounts aren’t documented no known
  standard is created.Without a known standard the ability to identify
  required accounts is diminished, increasing the opportunity for error when
  such a standard is needed (i.e. COOP, IR, etc.).",0.3,[],low,WA120,V-2257,SV-32951r1_rule,WA120 A22,"[""AC-2"", ""Rev_4""]","Proposed Questions: How many user accounts are associated with
  the Web server operation and maintenance?

  Where are these accounts documented?

  Use the command line utility more /etc/passwd to identify the accounts on the
  web server.

  Query the SA or Web Manager regarding the use of each account and each group.

  If the documentation does not match the users and groups found on the server,
  this is a finding. ","Document the administrative users and groups which have access
  rights to the web server in the web site SOP or in an equivalent document.","control ""V-2257"" do

  title ""Administrative users and groups that have access rights to the web
  server must be documented.""

  desc""There are typically several individuals and groups that are involved in
  running a production web server.These accounts must be restricted to only
  those necessary to maintain web services, review the server’s operation, and
  the operating system.By minimizing the amount of user and group accounts on
  a web server the total attack surface of the server is
  minimized.Additionally, if the required accounts aren’t documented no known
  standard is created.Without a known standard the ability to identify
  required accounts is diminished, increasing the opportunity for error when
  such a standard is needed (i.e. COOP, IR, etc.).""

  impact 0.3
  tag ""severity"": ""low""
  tag ""gtitle"": ""WA120""
  tag ""gid"": ""V-2257""
  tag ""rid"": ""SV-32951r1_rule""
  tag ""stig_id"": ""WA120 A22""
  tag ""nist"": [""AC-2"", ""Rev_4""]

  tag ""check"": ""Proposed Questions: How many user accounts are associated with
  the Web server operation and maintenance?

  Where are these accounts documented?

  Use the command line utility more /etc/passwd to identify the accounts on the
  web server.

  Query the SA or Web Manager regarding the use of each account and each group.

  If the documentation does not match the users and groups found on the server,
  this is a finding. ""

  tag ""fix"": ""Document the administrative users and groups which have access
  rights to the web server in the web site SOP or in an equivalent document.""

  begin
    DOCUMENTED_ADMINS = [SYS_ADMIN, NGINX_OWNER]

    describe nginx_conf(NGINX_CONF_FILE).params['user'].flatten do
      it{ should be_in DOCUMENTED_ADMINS}
    end

  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end

end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-2257.rb"", ""line""=>48}",V-2257,passed,"[""nginx""] should be in ""root"" and ""nginx""",0.000329,2017-09-22 14:13:01 -0400,"",""
"Web server system files must conform to minimum file permission
  requirements.","This check verifies that the key web server system configuration files
  are owned by the SA or the web administrator controlled account. These same
  files that control the configuration of the web server, and thus its
  behavior, must also be accessible by the account that runs the web service.
  If these files are altered by a malicious user, the web server would no
  longer be under the control of its managers and owners; properties in the
  web server configuration could be altered to compromise the entire server
  platform.",0.5,[],medium,WG300,V-2259,SV-32938r1_rule,WG300 A22,"[""AC-3"", ""AC-6"", ""Rev_4""]","Nginx directory and file permissions and ownership should be
  set per the following table.. The installation directories may vary from one
  installation to the next.If used, the WebAmins group should contain only
  accounts of persons authorized to manage the web server configuration,
  otherwise the root group should own all Nginx files and directories.

  If the files and directories are not set to the following permissions or more
  restrictive, this is a finding.

  grep for the root directive on the nginx.conf file and any separate
  included configuration files to find the Nginx root directory

  /usr/sbin/nginx       root WebAdmin  550/550
  /etc/nginx/           root WebAdmin 770/660
  /etc/nginx/conf.d     root WebAdmin 770/660
  /etc/nginx/modules    root WebAdmin 770/660
  /usr/share/nginx/html root WebAdmin  775/664
  /var/log/nginx        root WebAdmin  750/640

  NOTE:  The permissions are noted as directories / files","Use the chmod command to set permissions on the web server
  system directories and files as follows.

  /usr/sbin/nginx       root WebAdmin  550/550
  /etc/nginx/           root WebAdmin 770/660
  /etc/nginx/conf.d     root WebAdmin 770/660
  /etc/nginx/modules    root WebAdmin 770/660
  /usr/share/nginx/html root WebAdmin  775/664
  /var/log/nginx        root WebAdmin  750/640
  ","control ""V-2259"" do

  title ""Web server system files must conform to minimum file permission
  requirements.""

  desc ""This check verifies that the key web server system configuration files
  are owned by the SA or the web administrator controlled account. These same
  files that control the configuration of the web server, and thus its
  behavior, must also be accessible by the account that runs the web service.
  If these files are altered by a malicious user, the web server would no
  longer be under the control of its managers and owners; properties in the
  web server configuration could be altered to compromise the entire server
  platform.""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WG300""
  tag ""gid"": ""V-2259""
  tag ""rid"": ""SV-32938r1_rule""
  tag ""stig_id"": ""WG300 A22""
  tag ""nist"": [""AC-3"", ""AC-6"", ""Rev_4""]

  tag ""check"": ""Nginx directory and file permissions and ownership should be
  set per the following table.. The installation directories may vary from one
  installation to the next.If used, the WebAmins group should contain only
  accounts of persons authorized to manage the web server configuration,
  otherwise the root group should own all Nginx files and directories.

  If the files and directories are not set to the following permissions or more
  restrictive, this is a finding.

  grep for the """"root"""" directive on the nginx.conf file and any separate
  included configuration files to find the Nginx root directory

  /usr/sbin/nginx       root WebAdmin  550/550
  /etc/nginx/           root WebAdmin 770/660
  /etc/nginx/conf.d     root WebAdmin 770/660
  /etc/nginx/modules    root WebAdmin 770/660
  /usr/share/nginx/html root WebAdmin  775/664
  /var/log/nginx        root WebAdmin  750/640

  NOTE:  The permissions are noted as directories / files""

  tag ""fix"": ""Use the chmod command to set permissions on the web server
  system directories and files as follows.

  /usr/sbin/nginx       root WebAdmin  550/550
  /etc/nginx/           root WebAdmin 770/660
  /etc/nginx/conf.d     root WebAdmin 770/660
  /etc/nginx/modules    root WebAdmin 770/660
  /usr/share/nginx/html root WebAdmin  775/664
  /var/log/nginx        root WebAdmin  750/640
  ""

  begin
    describe.one do
      describe file('/usr/sbin/nginx') do
        it { should be_owned_by SYS_ADMIN }
        its('group') { should cmp SYS_ADMIN_GROUP }
        its('mode') { should cmp <= 550 }
      end
      describe file('/usr/sbin/nginx') do
        it { should be_owned_by NGINX_OWNER }
        its('group') { should cmp NGINX_GROUP }
        its('mode') { should cmp <= 550 }
      end
    end
    describe.one do
      describe file('/etc/nginx/') do
        it { should be_owned_by SYS_ADMIN }
        its('group') { should cmp SYS_ADMIN_GROUP }
        its('mode') { should cmp <= 770 }
      end
      describe file('/etc/nginx/') do
        it { should be_owned_by NGINX_OWNER }
        its('group') { should cmp NGINX_GROUP }
        its('mode') { should cmp <= 660 }
      end
    end
    describe.one do
      describe file('/etc/nginx/conf.d') do
        it { should be_owned_by SYS_ADMIN }
        its('group') { should cmp SYS_ADMIN_GROUP }
        its('mode') { should cmp <= 770 }
      end
      describe file('/etc/nginx/conf.d') do
        it { should be_owned_by NGINX_OWNER }
        its('group') { should cmp NGINX_GROUP }
        its('mode') { should cmp <= 660 }
      end
    end
    describe.one do
      describe file('/etc/nginx/modules') do
        it { should be_owned_by SYS_ADMIN }
        its('group') { should cmp SYS_ADMIN_GROUP }
        its('mode') { should cmp <= 770 }
      end
      describe file('/etc/nginx/modules') do
        it { should be_owned_by NGINX_OWNER }
        its('group') { should cmp NGINX_GROUP }
        its('mode') { should cmp <= 660 }
      end
    end
    describe.one do
      describe file('/usr/share/nginx/html') do
        it { should be_owned_by SYS_ADMIN }
        its('group') { should cmp SYS_ADMIN_GROUP }
        its('mode') { should cmp <= 775 }
      end
      describe file('/usr/share/nginx/html') do
        it { should be_owned_by NGINX_OWNER }
        its('group') { should cmp NGINX_GROUP }
        its('mode') { should cmp <= 664 }
      end
    end
    describe.one do
      describe file('/var/log/nginx') do
        it { should be_owned_by SYS_ADMIN }
        its('group') { should cmp SYS_ADMIN_GROUP }
        its('mode') { should cmp <= 750 }
      end
      describe file('/var/log/nginx') do
        it { should be_owned_by NGINX_OWNER }
        its('group') { should cmp NGINX_GROUP }
        its('mode') { should cmp <= 640 }
      end
    end

  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end

end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-2259.rb"", ""line""=>59}",V-2259,"passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed","File /usr/sbin/nginx should be owned by ""root"",File /usr/sbin/nginx group should cmp == ""root"",File /usr/sbin/nginx mode should cmp <= 550,File /etc/nginx/ should be owned by ""root"",File /etc/nginx/ group should cmp == ""root"",File /etc/nginx/ mode should cmp <= 770,File /etc/nginx/conf.d should be owned by ""root"",File /etc/nginx/conf.d group should cmp == ""root"",File /etc/nginx/conf.d mode should cmp <= 770,File /etc/nginx/modules should be owned by ""root"",File /etc/nginx/modules group should cmp == ""root"",File /etc/nginx/modules mode should cmp <= 770,File /usr/share/nginx/html should be owned by ""nginx"",File /usr/share/nginx/html group should cmp == ""nginx"",File /usr/share/nginx/html mode should cmp <= 664,File /var/log/nginx should be owned by ""root"",File /var/log/nginx group should cmp == ""root"",File /var/log/nginx mode should cmp <= 750","0.000183,0.000244,0.000304,0.000164,0.000228,0.000425,0.000265,0.00048,0.000323,0.000293,0.000516,0.0009,0.001347,0.000755,0.000311,0.000359,0.000336,0.000632","2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400,2017-09-22 14:13:01 -0400",",,,,,,,,,,,,,,,,,",",,,,,,,,,,,,,,,,,"
A public web server must limit email to outbound only.,"Incoming E-mail has been known to provide hackers with access to
 servers. Disabling the incoming mail service prevents this type of attacks.
 Additionally, Email represents the main use of the Internet. It is
 specialized application that requires the dedication of server resources. To
 combine this type of transaction processing function with the file serving
 role of the web server creates an inherent conflict. Supporting mail
 services on a web server opens the server to the risk of abuse as an email
 relay. falseWeb AdministratorECSC-1",0.5,[],medium,WG330,V-2261,SV-32937r1_rule,WG330 A22,"[""CM-6"", ""Rev_4""]","""To determine if email applications are excepting incoming
  connections (on standard ports)enter the following command:

  telnet localhost 25

  review the command results, If an e-mail program is installed and that program
  has been configured to accept inbound email, this is a finding."" ",Configure the email application to not allow incoming connections.,"control ""V-2261"" do
  title ""A public web server must limit email to outbound only.""

  desc"" Incoming E-mail has been known to provide hackers with access to
  servers. Disabling the incoming mail service prevents this type of attacks.
  Additionally, Email represents the main use of the Internet. It is
  specialized application that requires the dedication of server resources. To
  combine this type of transaction processing function with the file serving
  role of the web server creates an inherent conflict. Supporting mail
  services on a web server opens the server to the risk of abuse as an email
  relay. falseWeb AdministratorECSC-1 ""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WG330""
  tag ""gid"": ""V-2261""
  tag ""rid"": ""SV-32937r1_rule""
  tag ""stig_id"": ""WG330 A22""
  tag ""nist"": [""CM-6"", ""Rev_4""]

  tag ""check"": ""\""To determine if email applications are excepting incoming
  connections (on standard ports)enter the following command:

  telnet localhost 25

  review the command results, If an e-mail program is installed and that program
  has been configured to accept inbound email, this is a finding.\"" ""

  tag ""fix"": ""Configure the email application to not allow incoming connections.""


  begin
    describe port(25) do
      it { should_not be_listening }
    end
  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end



end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-2261.rb"", ""line""=>29}",V-2261,passed,Port 25 should not be listening,0.14362,2017-09-22 14:13:01 -0400,"",""
"Monitoring software must include CGI or equivalent programs in its
  scope.","By their very nature, CGI type files permit the anonymous web user to
  interact with data and perhaps store data on the web server. In many cases,
  CGI scripts exercise system-level control over the server’s resources. These
  files make appealing targets for the malicious user. If these files can be
  modified or exploited, the web server can be compromised. These files must
  be monitored by a security tool that reports unauthorized changes to these
  files.",0.5,[],medium,WG440,V-2271,SV-32927r2_rule,WG440 A22,"[""AU-6"", ""AC-3"", ""Rev_4""]","CGI or equivalent files must be monitored by a security tool
  that reports unauthorized changes. It is the purpose of such software to
  monitor key files for unauthorized changes to them. The reviewer should
  query the ISSO, the SA, and the web administrator and verify the information
  provided by asking to see the template file or configuration file of the
  software being used to accomplish this security task. Example file
  extensions for files considered to provide active content are, but not
  limited to, .cgi, .asp, .aspx, .class, .vb, .php, .pl, and .c.

  If the site does not have a process in place to monitor changes to CGI program
  files, this is a finding.","Use a monitoring tool to monitor changes to the CGI or
  equivalent directory. This can be done with something as simple as a script or
  batch file that would identify a change in the file.","control ""V-2271"" do
  title ""Monitoring software must include CGI or equivalent programs in its
  scope.""
  desc ""By their very nature, CGI type files permit the anonymous web user to
  interact with data and perhaps store data on the web server. In many cases,
  CGI scripts exercise system-level control over the server’s resources. These
  files make appealing targets for the malicious user. If these files can be
  modified or exploited, the web server can be compromised. These files must
  be monitored by a security tool that reports unauthorized changes to these
  files.""
  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WG440""
  tag ""gid"": ""V-2271""
  tag ""rid"": ""SV-32927r2_rule""
  tag ""stig_id"": ""WG440 A22""
  tag ""nist"": [""AU-6"", ""AC-3"", ""Rev_4""]

  tag ""check"": ""CGI or equivalent files must be monitored by a security tool
  that reports unauthorized changes. It is the purpose of such software to
  monitor key files for unauthorized changes to them. The reviewer should
  query the ISSO, the SA, and the web administrator and verify the information
  provided by asking to see the template file or configuration file of the
  software being used to accomplish this security task. Example file
  extensions for files considered to provide active content are, but not
  limited to, .cgi, .asp, .aspx, .class, .vb, .php, .pl, and .c.

  If the site does not have a process in place to monitor changes to CGI program
  files, this is a finding.""

  tag ""fix"": ""Use a monitoring tool to monitor changes to the CGI or
  equivalent directory. This can be done with something as simple as a script or
  batch file that would identify a change in the file.""

  begin
    describe package(MONITORINGSOFTWARE) do
      it{ should be_installed }
    end
  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-2271.rb"", ""line""=>35}",V-2271,passed,System Package audit should be installed,0.376298,2017-09-22 14:13:01 -0400,"",""
Active software modules must be minimized.,"Modules are the source of nginx httpd servers core and dynamic
  capabilities. Thus not every module available is needed for operation. Most
  installations only need a small subset of the modules available. By
  minimizing the enabled modules to only those that are required, we reduce
  the number of doors and have therefore reduced the attack surface of the web
  site. Likewise having fewer modules means less software that could have
  vulnerabilities.",0.5,[],medium,WA00500,V-26285,SV-33215r1_rule,WA00500 A22,"[""CM-2"", ""Rev_4""]","Enter the following command:

  nginx -V

  This will provide a list of the loaded modules. Validate that all displayed
  modules are required for operations. If any module is not required for
  operation, this is a finding.

  Note:  The following modules are needed for basic web function and do not need
  to be reviewed:

  ngx_http_* modules, except for modules excluded in the following rules below","Disable any modules that are not needed.

  Use the configure script (available in the nginx download package) to exclude
  modules using the --without {module_name} option to reject unneeded modules.","control ""V-26285"" do
  title ""Active software modules must be minimized.""

  desc ""Modules are the source of nginx httpd servers core and dynamic
  capabilities. Thus not every module available is needed for operation. Most
  installations only need a small subset of the modules available. By
  minimizing the enabled modules to only those that are required, we reduce
  the number of doors and have therefore reduced the attack surface of the web
  site. Likewise having fewer modules means less software that could have
  vulnerabilities.""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WA00500""
  tag ""gid"": ""V-26285""
  tag ""rid"": ""SV-33215r1_rule""
  tag ""stig_id"": ""WA00500 A22""
  tag ""nist"": [""CM-2"", ""Rev_4""]

  tag ""check"": ""Enter the following command:

  nginx -V

  This will provide a list of the loaded modules. Validate that all displayed
  modules are required for operations. If any module is not required for
  operation, this is a finding.

  Note:  The following modules are needed for basic web function and do not need
  to be reviewed:

  ngx_http_* modules, except for modules excluded in the following rules below""

  tag ""fix"": ""Disable any modules that are not needed.

  Use the configure script (available in the nginx download package) to exclude
  modules using the --without {module_name} option to reject unneeded modules.""

  begin
    describe nginx do
      its('modules') { should be_in NGINX_AUTHORIZED_MODULES }
    end
    describe nginx do
      its('modules') { should_not be_in NGINX_UNAUTHORIZED_MODULES }
    end
  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-26285.rb"", ""line""=>67}",V-26285,"passed,passed","Nginx Environment modules should be in ""http_addition"", ""http_auth_request"", ""http_dav"", ""http_flv"", ""http_gunzip"", ""http_gzip_static"", ""http_mp4"", ""http_random_index"", ""http_realip"", ""http_secure_link"", ""http_slice"", ""http_ssl"", ""http_stub_status"", ""http_sub"", ""http_v2"", ""mail_ssl"", ""stream_realip"", ""stream_ssl"", and ""stream_ssl_preread"",Nginx Environment modules should not be in","0.000416,0.000158","2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400",",",","
Web Distributed Authoring and Versioning (WebDAV) must be disabled.,"Ngx_http_dav_module supports WebDAV ('Web-based Distributed Authoring
  and Versioning') functionality for nginx. WebDAV is an extension to the HTTP
  protocol which allows clients to create, move, and delete files and
  resources on the web server. WebDAV is not widely used, and has serious
  security concerns as it may allow clients to modify unauthorized files on
  the web server. Therefore, the WebDav module ngx_http_dav_module should be
  disabled.",0.5,[],medium,WA00505,V-26287,SV-33216r1_rule,WA00505 A22,"[""AC-3"", ""Rev_4""]","Enter the following command:

  nginx -V

  This will provide a list of all loaded modules.  If the following module is
  found, this is a finding.

  ngx_http_dav_module","Disable any modules that are not needed.

  Use the configure script (available in the nginx download package) to exclude
  modules using the --without {module_name} option to reject unneeded modules.","control ""V-26287"" do
  title ""Web Distributed Authoring and Versioning (WebDAV) must be disabled.""

  desc ""Ngx_http_dav_module supports WebDAV ('Web-based Distributed Authoring
  and Versioning') functionality for nginx. WebDAV is an extension to the HTTP
  protocol which allows clients to create, move, and delete files and
  resources on the web server. WebDAV is not widely used, and has serious
  security concerns as it may allow clients to modify unauthorized files on
  the web server. Therefore, the WebDav module ngx_http_dav_module should be
  disabled.""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WA00505""
  tag ""gid"": ""V-26287""
  tag ""rid"": ""SV-33216r1_rule""
  tag ""stig_id"": ""WA00505 A22""
  tag ""nist"": [""AC-3"", ""Rev_4""]

  tag ""check"": ""Enter the following command:

  nginx -V

  This will provide a list of all loaded modules.  If the following module is
  found, this is a finding.

  ngx_http_dav_module""

  tag ""fix"": ""Disable any modules that are not needed.

  Use the configure script (available in the nginx download package) to exclude
  modules using the --without {module_name} option to reject unneeded modules.""

  begin
    describe nginx do
      its('modules') { should_not include 'ngx_http_dav' }
    end
  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-26287.rb"", ""line""=>35}",V-26287,passed,"Nginx Environment modules should not include ""ngx_http_dav""",0.001536,2017-09-22 14:13:02 -0400,"",""
Web server status module must be disabled.,"The ngx_http_status_module provides configuration information on
  thecurrent server and performance statistics. While having server
  configuration and status information available as a web page may be
  convenient, it is recommended that these modules not be enabled.",0.5,[],medium,WA00510,V-26294,SV-33218r1_rule,WA00510 A22,"[""AC-3"", ""Rev_4""]","Enter the following command:

  nginx -V

  This will provide a list of all loaded modules.  If the following module is
  found, this is a finding.

  ngx_http_status_module","Disable any modules that are not needed.

  Use the configure script (available in the nginx download package) to exclude
  modules using the --without {module_name} option to reject unneeded modules.","control ""V-26294"" do
  title ""Web server status module must be disabled.""

  desc ""The ngx_http_status_module provides configuration information on
  thecurrent server and performance statistics. While having server
  configuration and status information available as a web page may be
  convenient, it is recommended that these modules not be enabled.""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WA00510""
  tag ""gid"": ""V-26294""
  tag ""rid"": ""SV-33218r1_rule""
  tag ""stig_id"": ""WA00510 A22""
  tag ""nist"": [""AC-3"", ""Rev_4""]

  tag ""check"": ""Enter the following command:

  nginx -V

  This will provide a list of all loaded modules.  If the following module is
  found, this is a finding.

  ngx_http_status_module""

  tag ""fix"": ""Disable any modules that are not needed.

  Use the configure script (available in the nginx download package) to exclude
  modules using the --without {module_name} option to reject unneeded modules.""

  begin
    describe nginx do
      its('modules') { should_not include 'ngx_http_status' }
    end
  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end

end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-26294.rb"", ""line""=>35}",V-26294,passed,"Nginx Environment modules should not include ""ngx_http_status""",0.000163,2017-09-22 14:13:02 -0400,"",""
The web server must not be configured as a proxy server.,"The ngx_http_proxy_module allow the server to act as a proxy (either
  forward or reverse proxy) of http and other protocols with additional proxy
  modules loaded. If the nginx installation is not intended to proxy requests
  to or from another network then the proxy module should not be loaded. Proxy
  servers can act as an important security control when properly configured,
  however a secure proxy server is not within the scope of this STIG. A web
  server should be primarily a web server or a proxy server but not both, for
  the same reasons that other multi-use servers are not recommended. Scanning
  for web servers that will also proxy requests is a very common attack, as
  proxy servers are useful for anonymizing attacks on other servers, or
  possibly proxying requests into an otherwise protected network.",0.5,[],medium,WA00520,V-26299,SV-33220r1_rule,WA00520 A22,"[""AC-3"", ""Rev_4""]","Enter the following command:

  nginx -V

  This will provide a list of all loaded modules.  If the following module is
  found, this is a finding.

  ngx_http_proxy_module","Disable any modules that are not needed.

  Use the configure script (available in the nginx download package) to exclude
  modules using the --without {module_name} option to reject unneeded modules.","control ""V-26299"" do
  title ""The web server must not be configured as a proxy server.""

  desc ""The ngx_http_proxy_module allow the server to act as a proxy (either
  forward or reverse proxy) of http and other protocols with additional proxy
  modules loaded. If the nginx installation is not intended to proxy requests
  to or from another network then the proxy module should not be loaded. Proxy
  servers can act as an important security control when properly configured,
  however a secure proxy server is not within the scope of this STIG. A web
  server should be primarily a web server or a proxy server but not both, for
  the same reasons that other multi-use servers are not recommended. Scanning
  for web servers that will also proxy requests is a very common attack, as
  proxy servers are useful for anonymizing attacks on other servers, or
  possibly proxying requests into an otherwise protected network.""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WA00520""
  tag ""gid"": ""V-26299""
  tag ""rid"": ""SV-33220r1_rule""
  tag ""stig_id"": ""WA00520 A22""
  tag ""nist"": [""AC-3"", ""Rev_4""]

  tag ""check"": ""Enter the following command:

  nginx -V

  This will provide a list of all loaded modules.  If the following module is
  found, this is a finding.

  ngx_http_proxy_module""

  tag ""fix"": ""Disable any modules that are not needed.

  Use the configure script (available in the nginx download package) to exclude
  modules using the --without {module_name} option to reject unneeded modules.""

  begin
    describe nginx do
      its('modules') { should_not include 'ngx_http_proxy' }
    end
  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-26299.rb"", ""line""=>35}",V-26299,passed,"Nginx Environment modules should not include ""ngx_http_proxy""",0.000175,2017-09-22 14:13:02 -0400,"",""
The process ID (PID) file must be properly secured.,"The pid directive sets the file path to the process ID file to which
  the server records the process id of the server, which is useful for sending
  a signal to the server process or for checking on the health of the process.
  If the PID file is placed in a writable directory, other accounts could
  create a denial of service attack and prevent the server from starting by
  creating a PID file with the same name.",0.5,[],medium,WA00530,V-26305,SV-33222r1_rule,WA00530 A22,"[""AC-3"", ""Rev_4""]","To find the pid file:

  grep pid+N52 The pid directive will indicate the location of the pid file
  (typical default: /usr/sbin/nginx.pid)

  Verify the permissions and ownership on the folder containing the PID file. If
  any user accounts other than root, auditor, or the account used to run the web
  server have permission to, or ownership of, this folder, this is a finding. If
  the PID file is located in the  web server Root this is a finding.","Modify the location, permissions, and/or ownership for the PID
  file folder. ","control ""V-26305"" do
  title ""The process ID (PID) file must be properly secured.""

  desc ""The pid directive sets the file path to the process ID file to which
  the server records the process id of the server, which is useful for sending
  a signal to the server process or for checking on the health of the process.
  If the PID file is placed in a writable directory, other accounts could
  create a denial of service attack and prevent the server from starting by
  creating a PID file with the same name.""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WA00530""
  tag ""gid"": ""V-26305""
  tag ""rid"": ""SV-33222r1_rule""
  tag ""stig_id"": ""WA00530 A22""
  tag ""nist"": [""AC-3"", ""Rev_4""]

  tag ""check"": ""To find the pid file:

  grep """"pid""""+N52 The pid directive will indicate the location of the pid file
  (typical default: /usr/sbin/nginx.pid)

  Verify the permissions and ownership on the folder containing the PID file. If
  any user accounts other than root, auditor, or the account used to run the web
  server have permission to, or ownership of, this folder, this is a finding. If
  the PID file is located in the  web server Root this is a finding.""

  tag ""fix"": ""Modify the location, permissions, and/or ownership for the PID
  file folder. ""

  begin
    webserver_roots = []
    nginx_conf_handle = nginx_conf(NGINX_CONF_FILE)

    nginx_conf_handle.http.entries.each do |http|
      webserver_roots.push(http.params['root']) unless http.params['root'].nil?
    end
    nginx_conf_handle.servers.entries.each do |server|
      webserver_roots.push(server.params['root']) unless server.params['root'].nil?
    end
    nginx_conf_handle.locations.entries.each do |location|
      webserver_roots.push(location.params['root']) unless location.params['root'].nil?
    end

    webserver_roots.flatten!.uniq!

    describe file(nginx_conf_handle.params['pid'].join) do
      it { should exist }
      its ('owner') { should match %r(#{NGINX_OWNER}|#{SYS_ADMIN}) }
      its ('group') { should match %r(#{NGINX_GROUP}|#{SYS_ADMIN_GROUP}) }
      its ('mode')  { should cmp <= 0660 }
    end unless nginx_conf_handle.params['pid'].nil?

    webserver_roots.each do |root|
      describe nginx_conf_handle.params['pid'].join do
        it { should_not match root }
      end unless nginx_conf_handle.params['pid'].nil?
    end

  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end

end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-26305.rb"", ""line""=>59}",V-26305,"passed,passed,passed,passed,passed,passed","File /var/run/nginx.pid should exist,File /var/run/nginx.pid owner should match /nginx|root/,File /var/run/nginx.pid group should match /nginx|root/,File /var/run/nginx.pid mode should cmp <= 432,/var/run/nginx.pid should not match ""/usr/share/nginx/html/app1"",/var/run/nginx.pid should not match ""/usr/share/nginx/html/app2""","0.048514,0.069752,0.000179,0.000341,0.000146,9.8e-05","2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400",",,,,,",",,,,,"
"The web server must be configured to listen on a specific IP address
  and port.","The nginx listen directive specifies the IP addresses and port numbers
  the nginx web server will listen for requests. Rather than be unrestricted
  to listen on all IP addresses available to the system, the specific IP
  address or addresses intended must be explicitly specified. Specifically a
  Listen directive with no IP address specified, or with an IP address of
  zero’s should not be used. Having multiple interfaces on web servers is
  fairly common, and without explicit Listen directives, the web server is
  likely to be listening on an inappropriate IP address / interface that were
  not intended for the web server. Single homed system with a single IP
  addressed are also required to have an explicit IP address in the Listen
  directive, in case additional interfaces are added to the system at a later
  date.",0.5,[],medium,WA00555,V-26326,SV-33228r1_rule,WA00555 A22,"[""CM-7"", ""Rev_4""]","Enter the following command:

  grep Listenon the nginx.conf file and any separate included
  configuration files.

  Review the results for the followingdirective: listen

  For any enabled Listen directives ensure they specify both an IP address and
  port number.

  If the Listen directive is found with only an IP address, or only a port
  number specified, this is finding. If the IP address is all zeros (i.e.
  0.0.0.0:80 or [::ffff:0.0.0.0]:80, this is a finding. If the Listen
  directive does not exist, this is a finding.","Edit the nginx.conf file and set the listen directive to
  listen on a specific IP address and port. ","control ""V-26326"" do

  title ""The web server must be configured to listen on a specific IP address
  and port.""

  desc ""The nginx listen directive specifies the IP addresses and port numbers
  the nginx web server will listen for requests. Rather than be unrestricted
  to listen on all IP addresses available to the system, the specific IP
  address or addresses intended must be explicitly specified. Specifically a
  Listen directive with no IP address specified, or with an IP address of
  zero’s should not be used. Having multiple interfaces on web servers is
  fairly common, and without explicit Listen directives, the web server is
  likely to be listening on an inappropriate IP address / interface that were
  not intended for the web server. Single homed system with a single IP
  addressed are also required to have an explicit IP address in the Listen
  directive, in case additional interfaces are added to the system at a later
  date.""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WA00555""
  tag ""gid"": ""V-26326""
  tag ""rid"": ""SV-33228r1_rule""
  tag ""stig_id"": ""WA00555 A22""
  tag ""nist"": [""CM-7"", ""Rev_4""]

  tag ""check"": ""Enter the following command:

  grep """"Listen""""on the nginx.conf file and any separate included
  configuration files.

  Review the results for the followingdirective: listen

  For any enabled Listen directives ensure they specify both an IP address and
  port number.

  If the Listen directive is found with only an IP address, or only a port
  number specified, this is finding. If the IP address is all zeros (i.e.
  0.0.0.0:80 or [::ffff:0.0.0.0]:80, this is a finding. If the Listen
  directive does not exist, this is a finding.""

  tag ""fix"": ""Edit the nginx.conf file and set the """"listen"""" directive to
  listen on a specific IP address and port. ""

  begin
    nginx_conf(NGINX_CONF_FILE).servers.entries.each do |server|
      server.params['listen'].each do |listen|
        describe listen.join do
          it { should match %r([0-9]+(?:\.[0-9]+){3}|[a-zA-Z]:[0-9]+) }
        end
        describe listen.join.split(':').first do
          it { should_not cmp '0.0.0.0' }
          it { should_not cmp '[::ffff:0.0.0.0]' }
        end
      end unless server.params['listen'].nil?
    end
  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end

end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-26326.rb"", ""line""=>35}",V-26326,"passed,passed,passed","localhost:80 should match /[0-9]+(?:\.[0-9]+){3}|[a-zA-Z]:[0-9]+/,localhost should not cmp == ""0.0.0.0"",localhost should not cmp == ""[::ffff:0.0.0.0]""","0.000138,0.000232,0.000202","2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400",",,",",,"
Automatic directory indexing must be disabled.,"The ngx_http_autoindex_module module processes requests ending with the
  slash character (‘/’) and produces a directory listing. Usually a request is
  passed to the ngx_http_autoindex_module module when the
  ngx_http_index_module module cannot find an index file. To an attacker, this
  can reveal files and subdirectory names giving clues as to the type or
  configuration of the nginx server, or information not intended to be
  presented.",0.5,[],medium,WA00515,V-26368,SV-33219r1_rule,WA00515 A22,"[""CM-2"", ""Rev_4""]","Enter the following command:

  nginx -V

  This will provide a list of all loaded modules.If the following module is
  found, this is a finding.

  ngx_autoindex_module","Disable any modules that are not needed.

  Use the configure script (available in the nginx download package) to exclude
  modules using the --without {module_name} option to reject unneeded modules.","control ""V-26368"" do
  title ""Automatic directory indexing must be disabled.""

  desc ""The ngx_http_autoindex_module module processes requests ending with the
  slash character (‘/’) and produces a directory listing. Usually a request is
  passed to the ngx_http_autoindex_module module when the
  ngx_http_index_module module cannot find an index file. To an attacker, this
  can reveal files and subdirectory names giving clues as to the type or
  configuration of the nginx server, or information not intended to be
  presented.""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WA00515""
  tag ""gid"": ""V-26368""
  tag ""rid"": ""SV-33219r1_rule""
  tag ""stig_id"": ""WA00515 A22""
  tag ""nist"": [""CM-2"", ""Rev_4""]

  tag ""check"": ""Enter the following command:

  nginx -V

  This will provide a list of all loaded modules.If the following module is
  found, this is a finding.

  ngx_autoindex_module""

  tag ""fix"": ""Disable any modules that are not needed.

  Use the configure script (available in the nginx download package) to exclude
  modules using the --without {module_name} option to reject unneeded modules.""

  begin
    describe nginx do
      its('modules') { should_not include 'ngx_autoindex' }
    end
  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-26368.rb"", ""line""=>35}",V-26368,passed,"Nginx Environment modules should not include ""ngx_autoindex""",0.000277,2017-09-22 14:13:02 -0400,"",""
HTTP request methods must be limited.,"The HTTP 1.1 protocol supports several request methods which are
  rarely used and potentially high risk.",0.5,[],medium,WA00565 ,V-26396,SV-33236r1_rule,WA00565 A22,"[""SC-3"", ""Rev_4""]","Review the nginx.conf file and any separate included
  configuration files.

  For every location (except root), ensure the following entry exists:

  ## Only GET, Post, PUT are allowed##
       if ($request_method !~ ^(GET|PUT|POST)$ ) {
           return 444;
       }
  ## In this case, it does not accept other HTTP methods such as HEAD,
  DELETE, SEARCH, TRACE ##

  If the entry is not found for every location, this is a finding.","Review the nginx.conf file and any separate included
  configuration files.

  For every location (except root), edit to add the following entry:

  ## Only GET, Post, PUT are allowed##
       if ($request_method !~ ^(GET|PUT|POST)$ ) {
           return 444;
       }
  ## In this case, it does not accept other HTTP methods such as HEAD, DELETE,
  SEARCH, TRACE ##
","control ""V-26396"" do
  title ""HTTP request methods must be limited.""

  desc ""The HTTP 1.1 protocol supports several request methods which are
  rarely used and potentially high risk. ""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WA00565 ""
  tag ""gid"": ""V-26396""
  tag ""rid"": ""SV-33236r1_rule""
  tag ""stig_id"": ""WA00565 A22""
  tag ""nist"": [""SC-3"", ""Rev_4""]

  tag ""check"": ""Review the nginx.conf file and any separate included
  configuration files.

  For every location (except root), ensure the following entry exists:

  ## Only GET, Post, PUT are allowed##
       if ($request_method !~ ^(GET|PUT|POST)$ ) {
           return 444;
       }
  ## In this case, it does not accept other HTTP methods such as HEAD,
  DELETE, SEARCH, TRACE ##

  If the entry is not found for every location, this is a finding.""

  tag ""fix"": ""Review the nginx.conf file and any separate included
  configuration files.

  For every location (except root), edit to add the following entry:

  ## Only GET, Post, PUT are allowed##
       if ($request_method !~ ^(GET|PUT|POST)$ ) {
           return 444;
       }
  ## In this case, it does not accept other HTTP methods such as HEAD, DELETE,
  SEARCH, TRACE ##
""

  begin
    nginx_conf(NGINX_CONF_FILE).locations.entries.each do |location|
      unless location.params[""_""].eql?([""/""])
        describe location.params['if'] do
          it { should_not be_nil}
        end
        location.params['if'].each do |ifcondition|
          describe ifcondition do
            it { should_not be_nil}
            its(['_']) { should cmp [""($request_method"", ""!~"", ""^(GET|PUT|POST)$"", "")""]}
            its(['return']) { should cmp [[""444""]]}
          end
        end unless location.params['if'].nil?
      end
    end
  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end

end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-26396.rb"", ""line""=>35}",V-26396,"passed,passed,passed,passed","[{""_""=>[""($request_method"", ""!~"", ""^(GET|PUT|POST)$"", "")""], ""return""=>[[""444""]]}] should not be nil,{""_""=>[""($request_method"", ""!~"", ""^(GET|PUT|POST)$"", "")""], ""return""=>[[""444""]]} should not be nil,{""_""=>[""($request_method"", ""!~"", ""^(GET|PUT|POST)$"", "")""], ""return""=>[[""444""]]} [""_""] should cmp == [""($request_method"", ""!~"", ""^(GET|PUT|POST)$"", "")""],{""_""=>[""($request_method"", ""!~"", ""^(GET|PUT|POST)$"", "")""], ""return""=>[[""444""]]} [""return""] should cmp == [[""444""]]","0.000153,0.000104,0.000257,0.000259","2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400",",,,",",,,"
The web server must remove all export ciphers from the cipher suite.,"During the initial setup of a Transport Layer Security (TLS) connection
  to the web server, the client sends a list of supported cipher suites in
  order of preference.The web server will reply with the cipher suite it will
  use for communication from the client list.If an attacker can intercept the
  submission of cipher suites to the web server and place, as the preferred
  cipher suite, a weak export suite, the encryption used for the session
  becomes easy for the attacker to break, often within minutes to hours.",0.5,[],medium,WG345,V-60707,SV-75159r1_rule,WG345 A22,"[""SC-8"", ""Rev_4""]","Review the nginx.conf file and any separate included
  configuration files.

  Ensure the following entry exists:

  server {      # enables server-side protection from BEAST attacks
  ssl_prefer_server_ciphers on;

       # Disabled insecure ciphers suite. For example, MD5, DES, RC4, PSK
  ssl_ciphers ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-
  AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-
  AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256
  :DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-
  CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-
  SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-
  CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4:@STRENGTH;

   # -!MEDIUM：exclude encryption cipher suites using 128 bit encryption. LOW：
   # -!exclude encryption cipher suites using 64 or 56 bit encryption algorithms
   # -!EXPORT： exclude export encryption algorithms including 40 and 56 bits
   # -!algorithms. aNULL：  exclude the cipher suites offering no authentication.
   # -!This is currently the anonymous DH algorithms and anonymous ECDH
   # -!algorithms.
          # These cipher suites are vulnerable to a man in the middle attack
          # and so their use is normally discouraged.
   # -!eNULL：exclude the NULL ciphers that is those offering no encryption.
          # Because these offer no encryption at all and are a security risk
          # they are disabled unless explicitly included.
   # @STRENGTH：sort the current cipher list in order of encryption algorithm key
   # @length.



  If the entry is not found, this is a finding.","Review the nginx.conf file and any separate included
  configuration files.

  Edit to ensure the following entry exists:

  server {
       # enables server-side protection from BEAST attacks
       ssl_prefer_server_ciphers on;

     # Disabled insecure ciphers suite. For example, MD5, DES, RC4, PSK
  ssl_ciphers ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-
  AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-
  AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256
  :DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-
  CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-
  SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-
  CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4:@STRENGTH;

   # -!MEDIUM：exclude encryption cipher suites using 128 bit encryption.
   # -!LOW：   exclude encryption cipher suites using 64 or 56 bit encryption algorithms
   # -!EXPORT： exclude export encryption algorithms including 40 and 56 bits algorithms.
   # -!aNULL：  exclude the cipher suites offering no authentication. This is currently the anonymous DH algorithms and anonymous ECDH algorithms.
          # These cipher suites are vulnerable to a man in the middle attack and so their use is normally discouraged.
   # -!eNULL：exclude the NULL ciphers that is those offering no encryption.
          # Because these offer no encryption at all and are a security risk they are disabled unless explicitly included.
   # @STRENGTH：sort the current cipher list in order of encryption algorithm key length.
  }
  ","control ""V-60707"" do
  title ""The web server must remove all export ciphers from the cipher suite.""

  desc ""During the initial setup of a Transport Layer Security (TLS) connection
  to the web server, the client sends a list of supported cipher suites in
  order of preference.The web server will reply with the cipher suite it will
  use for communication from the client list.If an attacker can intercept the
  submission of cipher suites to the web server and place, as the preferred
  cipher suite, a weak export suite, the encryption used for the session
  becomes easy for the attacker to break, often within minutes to hours.""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WG345""
  tag ""gid"": ""V-60707""
  tag ""rid"": ""SV-75159r1_rule""
  tag ""stig_id"": ""WG345 A22""
  tag ""nist"": [""SC-8"", ""Rev_4""]

  tag ""check"": ""Review the nginx.conf file and any separate included
  configuration files.

  Ensure the following entry exists:

  server {      # enables server-side protection from BEAST attacks
  ssl_prefer_server_ciphers on;

       # Disabled insecure ciphers suite. For example, MD5, DES, RC4, PSK
  ssl_ciphers """"ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-
  AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-
  AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256
  :DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-
  CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-
  SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-
  CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4:@STRENGTH"""";

   # -!MEDIUM：exclude encryption cipher suites using 128 bit encryption. LOW：
   # -!exclude encryption cipher suites using 64 or 56 bit encryption algorithms
   # -!EXPORT： exclude export encryption algorithms including 40 and 56 bits
   # -!algorithms. aNULL：  exclude the cipher suites offering no authentication.
   # -!This is currently the anonymous DH algorithms and anonymous ECDH
   # -!algorithms.
          # These cipher suites are vulnerable to a """"man in the middle"""" attack
          # and so their use is normally discouraged.
   # -!eNULL：exclude the """"NULL"""" ciphers that is those offering no encryption.
          # Because these offer no encryption at all and are a security risk
          # they are disabled unless explicitly included.
   # @STRENGTH：sort the current cipher list in order of encryption algorithm key
   # @length.



  If the entry is not found, this is a finding.""

  tag ""fix"": ""Review the nginx.conf file and any separate included
  configuration files.

  Edit to ensure the following entry exists:

  server {
       # enables server-side protection from BEAST attacks
       ssl_prefer_server_ciphers on;

     # Disabled insecure ciphers suite. For example, MD5, DES, RC4, PSK
  ssl_ciphers """"ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-
  AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-
  AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256
  :DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-
  CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-
  SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-
  CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4:@STRENGTH"""";

   # -!MEDIUM：exclude encryption cipher suites using 128 bit encryption.
   # -!LOW：   exclude encryption cipher suites using 64 or 56 bit encryption algorithms
   # -!EXPORT： exclude export encryption algorithms including 40 and 56 bits algorithms.
   # -!aNULL：  exclude the cipher suites offering no authentication. This is currently the anonymous DH algorithms and anonymous ECDH algorithms.
          # These cipher suites are vulnerable to a """"man in the middle"""" attack and so their use is normally discouraged.
   # -!eNULL：exclude the """"NULL"""" ciphers that is those offering no encryption.
          # Because these offer no encryption at all and are a security risk they are disabled unless explicitly included.
   # @STRENGTH：sort the current cipher list in order of encryption algorithm key length.
  }
  ""

  begin
    disabled_ssl_ciphers = ['aNULL', 'eNULL', 'EXPORT', 'DES', 'MD5', 'PSK', 'RC4']
    nginx_conf_handle = nginx_conf(NGINX_CONF_FILE)

    nginx_conf_handle.http.entries.each do |http|
      describe http.params['ssl_prefer_server_ciphers'] do
        it { should cmp [['on']]}
      end
      describe http.params['ssl_ciphers'] do
        it { should_not be_nil }
      end

      unless http.params['ssl_ciphers'].nil?
        disabled_ssl_ciphers.each do |cipher|
          describe http.params['ssl_ciphers'].join do
            it { should match ""!#{cipher}""}
          end
        end
        describe http.params['ssl_ciphers'].join do
          it { should match '@STRENGTH'}
        end
      end
    end

    nginx_conf_handle.servers.entries.each do |server|
      describe server.params['ssl_prefer_server_ciphers'] do
        it { should cmp [['on']]}
      end unless server.params['ssl_prefer_server_ciphers'].nil?

      unless server.params['ssl_ciphers'].nil?
        disabled_ssl_ciphers.each do |cipher|
          describe server.params['ssl_ciphers'].join do
            it { should match ""!#{cipher}""}
          end
        end
        describe server.params['ssl_ciphers'].join do
          it { should match '@STRENGTH'}
        end
      end
    end

  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end

end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-60707.rb"", ""line""=>35}",V-60707,"passed,passed,passed,passed,passed,passed,passed,passed,passed,passed","[[""on""]] should cmp == [[""on""]],[[""'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA@STRENGTH'""]] should not be nil,'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA@STRENGTH' should match ""!aNULL"",'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA@STRENGTH' should match ""!eNULL"",'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA@STRENGTH' should match ""!EXPORT"",'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA@STRENGTH' should match ""!DES"",'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA@STRENGTH' should match ""!MD5"",'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA@STRENGTH' should match ""!PSK"",'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA@STRENGTH' should match ""!RC4"",'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA@STRENGTH' should match ""@STRENGTH""","0.000164,9.4e-05,0.000122,9.8e-05,0.0001,0.0001,8.9e-05,0.000133,8.8e-05,8.9e-05","2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400",",,,,,,,,,",",,,,,,,,,"
"Web server content and configuration files must be part of a routine
  backup program.","Backing up web server data and web server application software after
  upgrades or maintenance ensures that recovery can be accomplished up to the
  current version. It also provides a means to determine and recover from
  subsequent unauthorized changes to the software and data.

  A tested and verifiable backup strategy will be implemented for web server
  software as well as all web server data files. Backup and recovery procedures
  will be documented and the Web Manager or SA for the specific application will
  be responsible for the design, test, and implementation of the procedures.

  The site will have a contingency processing plan/disaster recovery plan that
  includes web servers. The contingency plan will be periodically tested in
  accordance with DoDI 8500.2 requirements.

  The site will identify an off-site storage facility in accordance with DoDI
  8500.2 requirements. Off-site backups will be updated on a regular basis and
  the frequency will be documented in the contingency plan.",0.3,[],low,WA140,V-6485,SV-32964r2_rule,WA140 A22,"[""CP-9"", ""Rev_4""]","Interview the Information Systems Security Officer (ISSO), SA,
  Web Manager, Webmaster or developers as necessary to determine whether or
  not a tested and verifiable backup strategy has been implemented for web
  server software as well as all web server data files.

  Proposed Questions: Who maintains the backup and recovery procedures? Do you
  have a copy of the backup and recovery procedures? Where is the off-site
  backup location? Is the contingency plan documented? When was the last time
  the contingency plan was tested? Are the test dates and results documented?

  If there is not a backup and recovery process for the web server, this is a
  finding. ",Document the backup procedures.,"control ""V-6485"" do

  title ""Web server content and configuration files must be part of a routine
  backup program.""

  desc""Backing up web server data and web server application software after
  upgrades or maintenance ensures that recovery can be accomplished up to the
  current version. It also provides a means to determine and recover from
  subsequent unauthorized changes to the software and data.

  A tested and verifiable backup strategy will be implemented for web server
  software as well as all web server data files. Backup and recovery procedures
  will be documented and the Web Manager or SA for the specific application will
  be responsible for the design, test, and implementation of the procedures.

  The site will have a contingency processing plan/disaster recovery plan that
  includes web servers. The contingency plan will be periodically tested in
  accordance with DoDI 8500.2 requirements.

  The site will identify an off-site storage facility in accordance with DoDI
  8500.2 requirements. Off-site backups will be updated on a regular basis and
  the frequency will be documented in the contingency plan. ""

  impact 0.3
  tag ""severity"": ""low""
  tag ""gtitle"": ""WA140""
  tag ""gid"": ""V-6485""
  tag ""rid"": ""SV-32964r2_rule""
  tag ""stig_id"": ""WA140 A22""
  tag ""nist"": [""CP-9"", ""Rev_4""]

  tag ""check"": ""Interview the Information Systems Security Officer (ISSO), SA,
  Web Manager, Webmaster or developers as necessary to determine whether or
  not a tested and verifiable backup strategy has been implemented for web
  server software as well as all web server data files.

  Proposed Questions: Who maintains the backup and recovery procedures? Do you
  have a copy of the backup and recovery procedures? Where is the off-site
  backup location? Is the contingency plan documented? When was the last time
  the contingency plan was tested? Are the test dates and results documented?

  If there is not a backup and recovery process for the web server, this is a
  finding. ""

  tag ""fix"": ""Document the backup procedures.""

  only_if {
    false
  }
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-6485.rb"", ""line""=>29}",V-6485,skipped,Operating System Detection,1.0e-05,2017-09-22 14:13:02 -0400,Skipped control due to only_if condition.,Operating System Detection
A web server must be segregated from other services.,"The web server installation and configuration plan should not support
  the co-hosting of multiple services such as Domain Name Service (DNS),
  e-mail, databases, search engines, indexing, or streaming media on the same
  server that is providing the web publishing service.By separating these
  services additional defensive layers are established between the web service
  and the applicable application should either be compromised.

  Disallowed or restricted services in the context of this vulnerability applies
  to services that are not directly associated with the delivery of web content.
  An operating system that supports a web server will not provide other services
  (e.g., domain controller, e-mail server, database server, etc.). Only those
  services necessary to support the web server and its hosted sites are
  specifically allowed and may include, but are not limited to, operating
  system, logging, anti-virus, host intrusion detection, administrative
  maintenance, or network requirements.",0.5,[],medium,WG204,V-6577,SV-32950r1_rule,WG204 A22,"[""SC-2"", ""Rev_4""]","Request a copy of and review the web server’s installation and
  configuration plan. Ensure that the server is in compliance with this plan.
  If the server is not in compliance with the plan, this is a finding.

  Query the SA to ascertain if and where the additional services are installed.

  Confirm that the additional service or application is not installed on the
  same partition as the operating systems root directory or the web document
  root. If it is, this is a finding.","Request a copy of and review the web server’s installation and
  configuration plan. Ensure that the server is in compliance with this plan.
  If the server is not in compliance with the plan, this is a finding.

  Query the SA to ascertain if and where the additional services are installed.

  Confirm that the additional service or application is not installed on the
  same partition as the operating systems root directory or the web document
  root. If it is, this is a finding.","control ""V-6577"" do

  title ""A web server must be segregated from other services.""

  desc""The web server installation and configuration plan should not support
  the co-hosting of multiple services such as Domain Name Service (DNS),
  e-mail, databases, search engines, indexing, or streaming media on the same
  server that is providing the web publishing service.By separating these
  services additional defensive layers are established between the web service
  and the applicable application should either be compromised.

  Disallowed or restricted services in the context of this vulnerability applies
  to services that are not directly associated with the delivery of web content.
  An operating system that supports a web server will not provide other services
  (e.g., domain controller, e-mail server, database server, etc.). Only those
  services necessary to support the web server and its hosted sites are
  specifically allowed and may include, but are not limited to, operating
  system, logging, anti-virus, host intrusion detection, administrative
  maintenance, or network requirements. ""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WG204""
  tag ""gid"": ""V-6577""
  tag ""rid"": ""SV-32950r1_rule""
  tag ""stig_id"": ""WG204 A22""
  tag ""nist"": [""SC-2"", ""Rev_4""]

  tag ""check"": ""Request a copy of and review the web server’s installation and
  configuration plan. Ensure that the server is in compliance with this plan.
  If the server is not in compliance with the plan, this is a finding.

  Query the SA to ascertain if and where the additional services are installed.

  Confirm that the additional service or application is not installed on the
  same partition as the operating systems root directory or the web document
  root. If it is, this is a finding.""

  tag ""fix"": ""Request a copy of and review the web server’s installation and
  configuration plan. Ensure that the server is in compliance with this plan.
  If the server is not in compliance with the plan, this is a finding.

  Query the SA to ascertain if and where the additional services are installed.

  Confirm that the additional service or application is not installed on the
  same partition as the operating systems root directory or the web document
  root. If it is, this is a finding.""
  begin
    # collect root directores from nginx_conf
    webserver_roots = []
    nginx_conf_handle = nginx_conf(NGINX_CONF_FILE)

    nginx_conf_handle.http.entries.each do |http|
      webserver_roots.push(http.params['root']) unless http.params['root'].nil?
    end

    nginx_conf_handle.servers.entries.each do |server|
      webserver_roots.push(server.params['root']) unless server.params['root'].nil?
    end

    nginx_conf_handle.locations.entries.each do |location|
      webserver_roots.push(location.params['root']) unless location.params['root'].nil?
    end

    webserver_roots.flatten!.uniq!

    services = command('systemctl -r --type service --all').stdout.scan(/^\s\s(.+).service/).flatten

    describe services do
      it{ should be_in ALLOWED_SERVICES_LIST}
    end

    describe services do
      it{ should_not be_in DISALLOWED_SERVICES_LIST}
    end

    services.each do |service|
      service_path = service(service).params['ExecStart'].scan(/path=(.+)[\s][;][\s]argv/).join
      describe service_path do
        it { should_not cmp '/'}
      end
      webserver_roots.each do |root|
        describe service_path do
          it { should_not match root}
        end
      end
    end

    if services.empty?
      describe do
        skip ""Skipped: no services found.""
      end
    end
  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end

end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-6577.rb"", ""line""=>97}",V-6577,"passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed,passed","[""auditd"", ""brandbot"", ""dbus"", ""dracut-shutdown"", ""emergency"", ""getty@tty1"", ""kmod-static-nodes"", ""network"", ""nginx"", ""rc-local"", ""rescue"", ""rhel-autorelabel-mark"", ""rhel-autorelabel"", ""rhel-configure"", ""rhel-dmesg"", ""rhel-import-state"", ""rhel-loadmodules"", ""rhel-readonly"", ""systemd-ask-password-console"", ""systemd-ask-password-wall"", ""systemd-binfmt"", ""systemd-firstboot"", ""systemd-fsck-root"", ""systemd-hwdb-update"", ""systemd-initctl"", ""systemd-journal-catalog-update"", ""systemd-journal-flush"", ""systemd-journald"", ""systemd-logind"", ""systemd-modules-load"", ""systemd-random-seed"", ""systemd-readahead-collect"", ""systemd-readahead-done"", ""systemd-readahead-replay"", ""systemd-reboot"", ""systemd-shutdownd"", ""systemd-sysctl"", ""systemd-tmpfiles-clean"", ""systemd-tmpfiles-setup-dev"", ""systemd-tmpfiles-setup"", ""systemd-udev-trigger"", ""systemd-udevd"", ""systemd-update-done"", ""systemd-update-utmp-runlevel"", ""systemd-update-utmp"", ""systemd-user-sessions"", ""systemd-vconsole-setup""] should be in ""brandbot"", ""dbus"", ""dracut-shutdown"", ""emergency"", ""getty@tty1"", ""kmod-static-nodes"", ""network"", ""nginx"", ""rc-local"", ""rescue"", ""rhel-autorelabel-mark"", ""rhel-autorelabel"", ""rhel-configure"", ""rhel-dmesg"", ""rhel-import-state"", ""rhel-loadmodules"", ""rhel-readonly"", ""serial-getty@ttyS0"", ""systemd-ask-password-console"", ""systemd-ask-password-wall"", ""systemd-binfmt"", ""systemd-firstboot"", ""systemd-fsck-root"", ""systemd-hwdb-update"", ""systemd-initctl"", ""systemd-journal-catalog-update"", ""systemd-journal-flush"", ""systemd-journald"", ""systemd-logind"", ""systemd-modules-load"", ""systemd-random-seed"", ""systemd-readahead-collect"", ""systemd-readahead-done"", ""systemd-readahead-replay"", ""systemd-reboot"", ""systemd-shutdownd"", ""systemd-sysctl"", ""systemd-tmpfiles-clean"", ""systemd-tmpfiles-setup-dev"", ""systemd-tmpfiles-setup"", ""systemd-udev-trigger"", ""systemd-udevd"", ""systemd-update-done"", ""systemd-update-utmp-runlevel"", ""systemd-update-utmp"", ""systemd-user-sessions"", ""systemd-vconsole-setup"", and ""auditd"",[""auditd"", ""brandbot"", ""dbus"", ""dracut-shutdown"", ""emergency"", ""getty@tty1"", ""kmod-static-nodes"", ""network"", ""nginx"", ""rc-local"", ""rescue"", ""rhel-autorelabel-mark"", ""rhel-autorelabel"", ""rhel-configure"", ""rhel-dmesg"", ""rhel-import-state"", ""rhel-loadmodules"", ""rhel-readonly"", ""systemd-ask-password-console"", ""systemd-ask-password-wall"", ""systemd-binfmt"", ""systemd-firstboot"", ""systemd-fsck-root"", ""systemd-hwdb-update"", ""systemd-initctl"", ""systemd-journal-catalog-update"", ""systemd-journal-flush"", ""systemd-journald"", ""systemd-logind"", ""systemd-modules-load"", ""systemd-random-seed"", ""systemd-readahead-collect"", ""systemd-readahead-done"", ""systemd-readahead-replay"", ""systemd-reboot"", ""systemd-shutdownd"", ""systemd-sysctl"", ""systemd-tmpfiles-clean"", ""systemd-tmpfiles-setup-dev"", ""systemd-tmpfiles-setup"", ""systemd-udev-trigger"", ""systemd-udevd"", ""systemd-update-done"", ""systemd-update-utmp-runlevel"", ""systemd-update-utmp"", ""systemd-user-sessions"", ""systemd-vconsole-setup""] should not be in ""mysql"", ""postgres"", and ""named"",/sbin/auditd should not cmp == ""/"",/sbin/auditd should not match ""/usr/share/nginx/html/app1"",/sbin/auditd should not match ""/usr/share/nginx/html/app2"",/usr/libexec/initscripts/brandbot should not cmp == ""/"",/usr/libexec/initscripts/brandbot should not match ""/usr/share/nginx/html/app1"",/usr/libexec/initscripts/brandbot should not match ""/usr/share/nginx/html/app2"",/bin/dbus-daemon should not cmp == ""/"",/bin/dbus-daemon should not match ""/usr/share/nginx/html/app1"",/bin/dbus-daemon should not match ""/usr/share/nginx/html/app2"",/usr/lib/dracut/dracut-initramfs-restore should not cmp == ""/"",/usr/lib/dracut/dracut-initramfs-restore should not match ""/usr/share/nginx/html/app1"",/usr/lib/dracut/dracut-initramfs-restore should not match ""/usr/share/nginx/html/app2"",/bin/sh should not cmp == ""/"",/bin/sh should not match ""/usr/share/nginx/html/app1"",/bin/sh should not match ""/usr/share/nginx/html/app2"",/sbin/agetty should not cmp == ""/"",/sbin/agetty should not match ""/usr/share/nginx/html/app1"",/sbin/agetty should not match ""/usr/share/nginx/html/app2"",/usr/bin/kmod should not cmp == ""/"",/usr/bin/kmod should not match ""/usr/share/nginx/html/app1"",/usr/bin/kmod should not match ""/usr/share/nginx/html/app2"",/etc/rc.d/init.d/network should not cmp == ""/"",/etc/rc.d/init.d/network should not match ""/usr/share/nginx/html/app1"",/etc/rc.d/init.d/network should not match ""/usr/share/nginx/html/app2"",/usr/sbin/nginx should not cmp == ""/"",/usr/sbin/nginx should not match ""/usr/share/nginx/html/app1"",/usr/sbin/nginx should not match ""/usr/share/nginx/html/app2"",/etc/rc.d/rc.local should not cmp == ""/"",/etc/rc.d/rc.local should not match ""/usr/share/nginx/html/app1"",/etc/rc.d/rc.local should not match ""/usr/share/nginx/html/app2"",/bin/sh should not cmp == ""/"",/bin/sh should not match ""/usr/share/nginx/html/app1"",/bin/sh should not match ""/usr/share/nginx/html/app2"",/bin/touch should not cmp == ""/"",/bin/touch should not match ""/usr/share/nginx/html/app1"",/bin/touch should not match ""/usr/share/nginx/html/app2"",/lib/systemd/rhel-autorelabel should not cmp == ""/"",/lib/systemd/rhel-autorelabel should not match ""/usr/share/nginx/html/app1"",/lib/systemd/rhel-autorelabel should not match ""/usr/share/nginx/html/app2"",/lib/systemd/rhel-configure should not cmp == ""/"",/lib/systemd/rhel-configure should not match ""/usr/share/nginx/html/app1"",/lib/systemd/rhel-configure should not match ""/usr/share/nginx/html/app2"",/usr/lib/systemd/rhel-dmesg should not cmp == ""/"",/usr/lib/systemd/rhel-dmesg should not match ""/usr/share/nginx/html/app1"",/usr/lib/systemd/rhel-dmesg should not match ""/usr/share/nginx/html/app2"",/lib/systemd/rhel-import-state should not cmp == ""/"",/lib/systemd/rhel-import-state should not match ""/usr/share/nginx/html/app1"",/lib/systemd/rhel-import-state should not match ""/usr/share/nginx/html/app2"",/lib/systemd/rhel-loadmodules should not cmp == ""/"",/lib/systemd/rhel-loadmodules should not match ""/usr/share/nginx/html/app1"",/lib/systemd/rhel-loadmodules should not match ""/usr/share/nginx/html/app2"",/lib/systemd/rhel-readonly should not cmp == ""/"",/lib/systemd/rhel-readonly should not match ""/usr/share/nginx/html/app1"",/lib/systemd/rhel-readonly should not match ""/usr/share/nginx/html/app2"",/usr/bin/systemd-tty-ask-password-agent should not cmp == ""/"",/usr/bin/systemd-tty-ask-password-agent should not match ""/usr/share/nginx/html/app1"",/usr/bin/systemd-tty-ask-password-agent should not match ""/usr/share/nginx/html/app2"",/usr/bin/systemd-tty-ask-password-agent should not cmp == ""/"",/usr/bin/systemd-tty-ask-password-agent should not match ""/usr/share/nginx/html/app1"",/usr/bin/systemd-tty-ask-password-agent should not match ""/usr/share/nginx/html/app2"",/usr/lib/systemd/systemd-binfmt should not cmp == ""/"",/usr/lib/systemd/systemd-binfmt should not match ""/usr/share/nginx/html/app1"",/usr/lib/systemd/systemd-binfmt should not match ""/usr/share/nginx/html/app2"",/usr/bin/systemd-firstboot should not cmp == ""/"",/usr/bin/systemd-firstboot should not match ""/usr/share/nginx/html/app1"",/usr/bin/systemd-firstboot should not match ""/usr/share/nginx/html/app2"",/usr/lib/systemd/systemd-fsck should not cmp == ""/"",/usr/lib/systemd/systemd-fsck should not match ""/usr/share/nginx/html/app1"",/usr/lib/systemd/systemd-fsck should not match ""/usr/share/nginx/html/app2"",/usr/bin/systemd-hwdb should not cmp == ""/"",/usr/bin/systemd-hwdb should not match ""/usr/share/nginx/html/app1"",/usr/bin/systemd-hwdb should not match ""/usr/share/nginx/html/app2"",/usr/lib/systemd/systemd-initctl should not cmp == ""/"",/usr/lib/systemd/systemd-initctl should not match ""/usr/share/nginx/html/app1"",/usr/lib/systemd/systemd-initctl should not match ""/usr/share/nginx/html/app2"",/usr/bin/journalctl should not cmp == ""/"",/usr/bin/journalctl should not match ""/usr/share/nginx/html/app1"",/usr/bin/journalctl should not match ""/usr/share/nginx/html/app2"",/usr/bin/journalctl should not cmp == ""/"",/usr/bin/journalctl should not match ""/usr/share/nginx/html/app1"",/usr/bin/journalctl should not match ""/usr/share/nginx/html/app2"",/usr/lib/systemd/systemd-journald should not cmp == ""/"",/usr/lib/systemd/systemd-journald should not match ""/usr/share/nginx/html/app1"",/usr/lib/systemd/systemd-journald should not match ""/usr/share/nginx/html/app2"",/usr/lib/systemd/systemd-logind should not cmp == ""/"",/usr/lib/systemd/systemd-logind should not match ""/usr/share/nginx/html/app1"",/usr/lib/systemd/systemd-logind should not match ""/usr/share/nginx/html/app2"",/usr/lib/systemd/systemd-modules-load should not cmp == ""/"",/usr/lib/systemd/systemd-modules-load should not match ""/usr/share/nginx/html/app1"",/usr/lib/systemd/systemd-modules-load should not match ""/usr/share/nginx/html/app2"",/usr/lib/systemd/systemd-random-seed should not cmp == ""/"",/usr/lib/systemd/systemd-random-seed should not match ""/usr/share/nginx/html/app1"",/usr/lib/systemd/systemd-random-seed should not match ""/usr/share/nginx/html/app2"",/usr/lib/systemd/systemd-readahead should not cmp == ""/"",/usr/lib/systemd/systemd-readahead should not match ""/usr/share/nginx/html/app1"",/usr/lib/systemd/systemd-readahead should not match ""/usr/share/nginx/html/app2"",/usr/bin/systemd-notify should not cmp == ""/"",/usr/bin/systemd-notify should not match ""/usr/share/nginx/html/app1"",/usr/bin/systemd-notify should not match ""/usr/share/nginx/html/app2"",/usr/lib/systemd/systemd-readahead should not cmp == ""/"",/usr/lib/systemd/systemd-readahead should not match ""/usr/share/nginx/html/app1"",/usr/lib/systemd/systemd-readahead should not match ""/usr/share/nginx/html/app2"",/usr/bin/systemctl should not cmp == ""/"",/usr/bin/systemctl should not match ""/usr/share/nginx/html/app1"",/usr/bin/systemctl should not match ""/usr/share/nginx/html/app2"",/usr/lib/systemd/systemd-shutdownd should not cmp == ""/"",/usr/lib/systemd/systemd-shutdownd should not match ""/usr/share/nginx/html/app1"",/usr/lib/systemd/systemd-shutdownd should not match ""/usr/share/nginx/html/app2"",/usr/lib/systemd/systemd-sysctl should not cmp == ""/"",/usr/lib/systemd/systemd-sysctl should not match ""/usr/share/nginx/html/app1"",/usr/lib/systemd/systemd-sysctl should not match ""/usr/share/nginx/html/app2"",/usr/bin/systemd-tmpfiles should not cmp == ""/"",/usr/bin/systemd-tmpfiles should not match ""/usr/share/nginx/html/app1"",/usr/bin/systemd-tmpfiles should not match ""/usr/share/nginx/html/app2"",/usr/bin/systemd-tmpfiles should not cmp == ""/"",/usr/bin/systemd-tmpfiles should not match ""/usr/share/nginx/html/app1"",/usr/bin/systemd-tmpfiles should not match ""/usr/share/nginx/html/app2"",/usr/bin/systemd-tmpfiles should not cmp == ""/"",/usr/bin/systemd-tmpfiles should not match ""/usr/share/nginx/html/app1"",/usr/bin/systemd-tmpfiles should not match ""/usr/share/nginx/html/app2"",/usr/bin/udevadm should not cmp == ""/"",/usr/bin/udevadm should not match ""/usr/share/nginx/html/app1"",/usr/bin/udevadm should not match ""/usr/share/nginx/html/app2"",/usr/lib/systemd/systemd-udevd should not cmp == ""/"",/usr/lib/systemd/systemd-udevd should not match ""/usr/share/nginx/html/app1"",/usr/lib/systemd/systemd-udevd should not match ""/usr/share/nginx/html/app2"",/usr/lib/systemd/systemd-update-done should not cmp == ""/"",/usr/lib/systemd/systemd-update-done should not match ""/usr/share/nginx/html/app1"",/usr/lib/systemd/systemd-update-done should not match ""/usr/share/nginx/html/app2"",/usr/lib/systemd/systemd-update-utmp should not cmp == ""/"",/usr/lib/systemd/systemd-update-utmp should not match ""/usr/share/nginx/html/app1"",/usr/lib/systemd/systemd-update-utmp should not match ""/usr/share/nginx/html/app2"",/usr/lib/systemd/systemd-update-utmp should not cmp == ""/"",/usr/lib/systemd/systemd-update-utmp should not match ""/usr/share/nginx/html/app1"",/usr/lib/systemd/systemd-update-utmp should not match ""/usr/share/nginx/html/app2"",/usr/lib/systemd/systemd-user-sessions should not cmp == ""/"",/usr/lib/systemd/systemd-user-sessions should not match ""/usr/share/nginx/html/app1"",/usr/lib/systemd/systemd-user-sessions should not match ""/usr/share/nginx/html/app2"",/usr/lib/systemd/systemd-vconsole-setup should not cmp == ""/"",/usr/lib/systemd/systemd-vconsole-setup should not match ""/usr/share/nginx/html/app1"",/usr/lib/systemd/systemd-vconsole-setup should not match ""/usr/share/nginx/html/app2""","0.000561,0.000201,0.000169,0.000116,9.0e-05,0.000155,0.000201,0.000158,0.000276,0.000115,9.9e-05,0.000181,0.000105,8.5e-05,0.000142,8.8e-05,8.3e-05,0.000188,8.6e-05,8.7e-05,0.000163,8.3e-05,0.000132,0.000185,8.4e-05,0.000114,0.000193,8.2e-05,9.1e-05,0.000141,8.0e-05,0.000216,0.000288,0.0001,9.1e-05,0.00017,9.5e-05,8.8e-05,0.000143,9.7e-05,9.0e-05,0.000237,0.000163,0.000127,0.000228,0.000113,9.2e-05,0.000181,8.8e-05,0.000108,0.000145,9.1e-05,9.4e-05,0.000142,8.4e-05,0.000105,0.000165,8.1e-05,8.0e-05,0.000153,8.3e-05,8.0e-05,0.00015,0.000132,9.8e-05,0.000169,8.6e-05,8.4e-05,0.000173,0.00016,8.8e-05,0.000186,9.4e-05,8.8e-05,0.000168,8.6e-05,0.000216,0.000384,0.000143,9.8e-05,0.000174,9.0e-05,8.5e-05,0.000152,8.3e-05,8.0e-05,0.000166,0.000132,9.7e-05,0.000159,8.9e-05,0.000139,0.000151,8.6e-05,8.4e-05,0.00016,8.8e-05,7.9e-05,0.000141,0.000102,8.2e-05,0.000143,8.4e-05,8.1e-05,0.000138,8.5e-05,8.2e-05,0.00014,9.7e-05,9.0e-05,0.00014,8.5e-05,8.4e-05,0.000141,0.000241,0.000192,0.000385,0.000148,0.00013,0.000223,0.000123,0.000122,0.0002,0.000101,0.000114,0.0002,0.00012,0.00012,0.000196,0.000104,0.000102,0.000167,0.000104,9.9e-05,0.000166,0.000103,0.000107,0.000169,0.000113,0.000101,0.000218,0.000123,0.000102","2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400",",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,",",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"
Web server and/or operating system information must be protected.,"The web server response header of an HTTP response can contain several
  fields of information including the requested HTML page. The information
  included in this response can be web server type and version, operating
  system and version, and ports associated with the web server. This provides
  the malicious user valuable information without the use of extensive
  tools.",0.3,[],low,WG520,V-6724,SV-36672r1_rule,WG520 A22,"[""CM-6"", ""Rev_4""]",",,",",,","control ""V-6724"" do
  title ""Web server and/or operating system information must be protected.""

  desc ""The web server response header of an HTTP response can contain several
  fields of information including the requested HTML page. The information
  included in this response can be web server type and version, operating
  system and version, and ports associated with the web server. This provides
  the malicious user valuable information without the use of extensive
  tools.""

  impact 0.3
  tag ""severity"": ""low""
  tag ""gtitle"": ""WG520""
  tag ""gid"": ""V-6724""
  tag ""rid"": ""SV-36672r1_rule""
  tag ""stig_id"": ""WG520 A22""
  tag ""nist"": [""CM-6"", ""Rev_4""]

  tag ""Enter the following command:

  grep """"server_tokens"""" on the nginx.conf file and any separate included
  configuration files

  The Directive server_tokens must be set to """"off"""" (ex. server_tokens off;).
  This directive disables emitting nginx version on error pages and in the
  “Server” response header field.

  If the web server or operating system information are sent to the client via
  the server response header or the directive does not exist, this is a finding.

  Note: The default value is set to on.""

  begin
    nginx_conf_handle = nginx_conf(NGINX_CONF_FILE)

    nginx_conf_handle.http.entries.each do |http|
      describe http.params['server_tokens'] do
        it { should cmp [['off']] }
      end
    end

    nginx_conf_handle.servers.entries.each do |server|
      describe.one do
        describe server.params['server_tokens'] do
          it { should be nil }
        end
        describe server.params['server_tokens'] do
          it { should cmp [['off']] }
        end
      end
    end
    nginx_conf_handle.locations.entries.each do |location|
      describe.one do
        describe location.params['server_tokens'] do
          it { should be nil }
        end
        describe location.params['server_tokens'] do
          it { should cmp [['off']] }
        end
      end
    end

  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end
end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-6724.rb"", ""line""=>35}",V-6724,"passed,passed,passed","[[""off""]] should cmp == [[""off""]],should equal nil,should equal nil","0.000186,8.8e-05,8.0e-05","2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400,2017-09-22 14:13:02 -0400",",,",",,"
The web server must restrict SSL protocols.,"During the initial setup of a Transport Layer Security (TLS) connection to the web server, the client sends a list of supported cipher suites in order of preference.  The web server will reply with the cipher suite it will use for communication from the client list.  If an attacker can intercept the submission of cipher suites to the web server and place, as the preferred cipher suite, a weak export suite, the encryption used for the session becomes easy for the attacker to break, often within minutes to hours.",0.5,[],medium,WG345,V-60707,SV-75159r1_rule,WG345 A22,"[""SC-8"", ""Rev_4""]","Review the nginx.conf file and any separate included configuration files.

Ensure the following entry exists:

server {
       # SSL protocols TLS v1~TLSv1.2 are allowed. Disabed SSLv3
       ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
}

If the entry is not found, this is a finding.","Review the nginx.conf file and any separate included
  configuration files.

  Edit to ensure the following entry exists:

  server {
         # SSL protocols TLS v1~TLSv1.2 are allowed. Disabed SSLv3
         ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
  }
  ","control ""V-new"" do

  title ""The web server must restrict SSL protocols.""

  desc ""During the initial setup of a Transport Layer Security (TLS) connection to the web server, the client sends a list of supported cipher suites in order of preference.  The web server will reply with the cipher suite it will use for communication from the client list.  If an attacker can intercept the submission of cipher suites to the web server and place, as the preferred cipher suite, a weak export suite, the encryption used for the session becomes easy for the attacker to break, often within minutes to hours.""

  impact 0.5
  tag ""severity"": ""medium""
  tag ""gtitle"": ""WG345""
  tag ""gid"": ""V-60707""
  tag ""rid"": ""SV-75159r1_rule""
  tag ""stig_id"": ""WG345 A22""
  tag ""nist"": [""SC-8"", ""Rev_4""]

  tag ""check"": ""Review the nginx.conf file and any separate included configuration files.

Ensure the following entry exists:

server {
       # SSL protocols TLS v1~TLSv1.2 are allowed. Disabed SSLv3
       ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
}

If the entry is not found, this is a finding.""

  tag ""fix"": ""Review the nginx.conf file and any separate included
  configuration files.

  Edit to ensure the following entry exists:

  server {
         # SSL protocols TLS v1~TLSv1.2 are allowed. Disabed SSLv3
         ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
  }
  ""

  begin
    nginx_conf_handle = nginx_conf(NGINX_CONF_FILE)

    nginx_conf_handle.http.entries.each do |http|
      describe http.params['ssl_protocols'] do
        it { should cmp [[""TLSv1"", ""TLSv1.1"", ""TLSv1.2""]] }
      end
    end

    nginx_conf_handle.servers.entries.each do |server|
      describe server.params['ssl_protocols'] do
        it { should cmp [[""TLSv1"", ""TLSv1.1"", ""TLSv1.2""]] }
      end unless server.params['ssl_protocols'].nil?
    end

  rescue Exception => msg
    describe ""Exception: #{msg}"" do
      it { should be_nil}
    end
  end

end
","{""ref""=>""/Users/rxman/Documents/MITRE/INSPEC/nginx-baseline/controls/V-new.rb"", ""line""=>35}",V-new,passed,"[[""TLSv1"", ""TLSv1.1"", ""TLSv1.2""]] should cmp == [[""TLSv1"", ""TLSv1.1"", ""TLSv1.2""]]",0.000171,2017-09-22 14:13:02 -0400,"",""
